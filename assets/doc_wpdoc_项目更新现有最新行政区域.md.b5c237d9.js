import{_ as s,o as a,c as n,Q as e,k as p}from"./chunks/framework.b1e56e49.js";const k=JSON.parse('{"title":"项目更新现有最新行政区域","description":"","frontmatter":{"title":"项目更新现有最新行政区域","date":"2021-08-19T15:06:36.000Z"},"headers":[],"relativePath":"doc/wpdoc/项目更新现有最新行政区域.md","filePath":"doc/wpdoc/项目更新现有最新行政区域.md"}'),o={name:"doc/wpdoc/项目更新现有最新行政区域.md"},i=e(`<p>aPaas地图的数据主要存在3处，一处是数据库中的pl_region表，另一处是安装在服务器下的aPaas路径下的Json文件，另外是数据库中其他的业务表对pl_region的引用，一般只存的regionid。需要做的就是替换这3处的数据。</p><h2 id="一、需要的文件-文章底部下载" tabindex="-1">一、需要的文件（文章底部下载） <a class="header-anchor" href="#一、需要的文件-文章底部下载" aria-label="Permalink to &quot;一、需要的文件（文章底部下载）&quot;">​</a></h2><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E5%9B%BE%E7%89%871-4.png" alt=""></p><h2 id="二、数据库的表替换" tabindex="-1">二、数据库的表替换 <a class="header-anchor" href="#二、数据库的表替换" aria-label="Permalink to &quot;二、数据库的表替换&quot;">​</a></h2><p>执行以下操作前，请先将数据库相关表进行备份</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">SELECT * into ka_kq_channelcustomers_bak1106 from ka_kq_channelcustomers</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">SELECT * into kx_kq_ka_bak1106 from kx_kq_ka</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">SELECT * into kx_kq_store_bak1106 from kx_kq_store</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">SELECT * into pl_region_bak1106 from pl_region</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">SELECT * into ka_kq_channelcustomers_bak1106 from ka_kq_channelcustomers</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">SELECT * into kx_kq_ka_bak1106 from kx_kq_ka</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">SELECT * into kx_kq_store_bak1106 from kx_kq_store</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">SELECT * into pl_region_bak1106 from pl_region</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>找到项目所在的数据库，右键表，运行SQL文件，选择上面的pl_region.sql文件。完成行政区域表的替换。</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E5%9B%BE%E7%89%872-3.png" alt=""></p><p>同样操作，运行SQL文件，选择上面的map_changes.sql文件。创建map_changes表。运行完可以查看，表里存的是替换前；后差异的数据，共347条行政区域数据发生了变化。这里主要指的regionid发生变化的，因为库里的业务表里一般存的都是regionid。</p><p>下一步要做的就是将业务表里发生改变的regionid替换过来。遍历业务表数据，替换regionid存在在map_changes里的数据，替换为map_changes里的regionid_new。<br> 例：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">UPDATE user_info u set code = m.regionid_new from map_changes m where u.code=m.regionid;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">UPDATE user_info u set code = m.regionid_new from map_changes m where u.code=m.regionid;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>一条sql搞定一个表。</p>`,12),l=p("p",{KA系统管理:""},"剩余还有{终端管理}、{费用归属经销商}、{供货批发商}、",-1),r=e(`<p>终端管理：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">UPDATE kx_kq_store k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">UPDATE kx_kq_store k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>费用归属经销商和供货批发商：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">UPDATE ka_kq_channelcustomers k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">UPDATE ka_kq_channelcustomers k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>KA系统管理:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">UPDATE kx_kq_ka k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">UPDATE kx_kq_ka k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="三、替换json文件" tabindex="-1">三、替换json文件 <a class="header-anchor" href="#三、替换json文件" aria-label="Permalink to &quot;三、替换json文件&quot;">​</a></h2><p>Xshell工具，Linux服务器地址47.115.23.83 用户名root 密码UsMXdz5gtBc7-G</p><p>找到服务器的/home/apaas/web/static/regionMap/map路径，把底下的所有json删除：</p><p>具体指令操作：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">cd /home/apaas/web/static/regionMap/map </span></span>
<span class="line"><span style="color:#e1e4e8;">//服务器路径</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">cd /home/apaas/web/static/regionMap/map </span></span>
<span class="line"><span style="color:#24292e;">//服务器路径</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>l. 查看是否有json文件</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rm -rf /home/apaas/web/static/regionMap/map</span></span>
<span class="line"><span style="color:#e1e4e8;">//删除json文件</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rm -rf /home/apaas/web/static/regionMap/map</span></span>
<span class="line"><span style="color:#24292e;">//删除json文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>rz 上传本地解压好的json文件，注意可能由于操作工具限制，文件上传数量有限制，可能需要分2-3次上传，并再次</p><p>ll. 查看文件名是否乱码（使用xshell的不会乱码）</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E5%9B%BE%E7%89%873-3.png" alt=""></p><p>上传成功后，请查看json文件名是否为正常中文字符显示，若xShell中文件名出现乱码，可能存在编码问题，导致文件执行不成功。</p><p>！！！另外全部执行完后，在终端分布图显示需要用到一个bi_dim_region业务表，需要再运行bi_dim_region.sql文件，将bi_dim_region表数据替换，</p><p>替换完成后可以登陆web页面，“统计报表”目录下的“终端分布图”、“渠道分布图”查看地图是否显示正常。</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E5%9B%BE%E7%89%874-1.png" alt=""></p><p>最后执行下updateJc.sql</p><h2 id="四、注意事项" tabindex="-1">四、注意事项 <a class="header-anchor" href="#四、注意事项" aria-label="Permalink to &quot;四、注意事项&quot;">​</a></h2><p>假如终端分布图里点击某一个地图没有反应，没有进入到下一级。说明对应的json有问题，定位替换那一个就行了。比如点北京市没反应，就检查”中国.北京.json”这个文件。</p><p><strong>附件下载地址：</strong><br><a href="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%A1%B9%E7%9B%AE%E6%9B%B4%E6%96%B0%E7%8E%B0%E6%9C%89%E6%9C%80%E6%96%B0%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%9F%9F.zip" title="项目更新现有最新行政区域" target="_blank" rel="noreferrer">项目更新现有最新行政区域</a></p>`,24),c=[i,l,r];function t(d,m,_,h,g,u){return a(),n("div",null,c)}const v=s(o,[["render",t]]);export{k as __pageData,v as default};
