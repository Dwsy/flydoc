import{_ as n,D as s,o as l,c as p,k as i,a as t,I as r,w as d,R as a}from"./chunks/framework.E9w9IFh5.js";const _=JSON.parse('{"title":"积分体系配置说明文档","description":"","frontmatter":{"title":"积分体系配置说明文档","date":"2022-06-08T11:57:01.000Z"},"headers":[],"relativePath":"doc/wpdoc/积分体系配置说明文档.md","filePath":"doc/wpdoc/积分体系配置说明文档.md"}'),g={name:"doc/wpdoc/积分体系配置说明文档.md"},c=a(`<h1 id="积分配置说明文档" tabindex="-1">积分配置说明文档 <a class="header-anchor" href="#积分配置说明文档" aria-label="Permalink to &quot;积分配置说明文档&quot;">​</a></h1><ul><li><p>编辑：黄崇文</p></li><li><p>时间：2022-06-10</p></li><li><p>状态：已完成</p></li><li><p>适用范围：智慧100V6.0</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>本文档包括如下内容</span></span>
<span class="line"><span> 1 业务场景&amp;流程</span></span>
<span class="line"><span> 2 积分实体，积分指标配置</span></span>
<span class="line"><span> 3 积分规则，积分方案设置</span></span>
<span class="line"><span> 4 程序中做扩展接入</span></span>
<span class="line"><span> 5 积分SPU智慧插件使用</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul><h2 id="一、业务场景-流程" tabindex="-1">一、业务场景&amp;流程 <a class="header-anchor" href="#一、业务场景-流程" aria-label="Permalink to &quot;一、业务场景&amp;流程&quot;">​</a></h2><p>1.1 场景说明</p><p>进行积分全流程管理，包括实施级的积分实体、指标的灵活配置，厂家管理层人员对积分规则的定义设置、不同区域经理对积分方案的自定义关联，业代/DSR一线人员执行对应积分动作后，可汇总展示积分结果、积分人员排名。<br> 可用于日常业务规范、特殊达标奖励等场景，为精耕、共耕、组合模式通用需求。</p><p>业务场景举例:</p><p>(1)每次铺货成功,+3<br> (2)每日拜访次数&gt;10次 +5分<br> (3)每日订单金额&gt;1000,通过 订单金额总数/10+1 计算积分值</p><p>1.2 积分类型说明</p>`,8),h=a(`<p>其中单次积分由积分SPU 智慧插件触发计算，累计积分/单次异步 通过di 调度方式汇集数据(存储函数),触发计算。注：这里有2个di 调度，后续说明。<br> (2)单次积分和单次异步类型的区别?<br> 单次积分：如拜访铺货成功，立即计算积分。单次异步:铺货成功不是马上计算积分，延迟计算。第2天才计算. 之所以有单次异步，可以是对性能层面的考虑.<br> 综上:单次积分实时(或者伪实时)计算，累计积分/单次异步每天调度计算(前一天数据)。</p><p>1.3 积分配置流程</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B.png" alt="&#39;积分配置流程&#39;"></p><p>说明: 配置实体,配置指标(积分模板)在配置中心操作。生成规则，配置方案在web 端积分管理配置。生成积分则使用SPU 插件(单次),或者di 调用的方式触发(单次异步/累计)。</p><h2 id="二、积分实体-积分指标配置" tabindex="-1">二、积分实体，积分指标配置 <a class="header-anchor" href="#二、积分实体-积分指标配置" aria-label="Permalink to &quot;二、积分实体，积分指标配置&quot;">​</a></h2><p>该步骤在产品配置中心中操作.</p><p>2.1 积分实体配置</p><p>积分实体配置包括4部分内容。对象表，配置可供计算属性，配置触发条件属性，配置赋值目标.<br> 名词解析:<br> (1) 对象表:该表和数据库业务表对象，必须是存在的表。<br> (2) 配置可供计算属性：属性必须来源于对象表的属性，积分规则获取积分计算。比如自定义订单金额/10+1 计算积分值。订单金额就是可以提供计算的属性。<br> (3) 配置触发条件属性:属性必须来源于对象表的属性，积分规则条件判断。比如 订单金额&gt;1000 , 提供作为触发属性。<br> (4) 配置赋值目标:属性必须来自对象表的属性，该项配置说明，积分计算到人员，还是终端上。即:获取积分的对象.<br> 下面对每一项配置进行具体解析.铺货为例子。<br> 对象表说明:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E5%AE%9E%E4%BD%93-%E5%AF%B9%E8%B1%A1%E8%A1%A8.png" alt="&#39;积分实体-对象表&#39;"></p><p>字段解析:</p><table><thead><tr><th style="text-align:right;">字段名称</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">对象表名</td><td style="text-align:right;">是</td><td style="text-align:center;">业务表，必须是DB 存在的表,如果不存在，则先创建</td></tr><tr><td style="text-align:right;">实体描述</td><td style="text-align:right;">是</td><td style="text-align:center;">如:铺货采集表</td></tr><tr><td style="text-align:right;">是否ide实体</td><td style="text-align:right;">是</td><td style="text-align:center;">积分实体类型.是:单次积分实体 否:累计/单次异步实体</td></tr><tr><td style="text-align:right;">(ide实体时显示)ide实体名</td><td style="text-align:right;">是</td><td style="text-align:center;">与对象表名一致也可以</td></tr></tbody></table><p>可供计算属性：</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E5%AE%9E%E4%BD%93-%E5%8F%AF%E4%BE%9B%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7.png" alt="&#39;积分实体-可供计算属性&#39;"></p><p>字段解析:</p><table><thead><tr><th style="text-align:right;">字段名称</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">列名称</td><td style="text-align:right;">是</td><td style="text-align:center;">积分规则获取积分计算，如计算表达式 订单金额/10+1</td></tr></tbody></table><p>触发条件属性：</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E5%AE%9E%E4%BD%93-%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6%E5%B1%9E%E6%80%A7.png" alt="&#39;积分实体-触发条件属性&#39;"></p><p>字段解析:</p><table><thead><tr><th style="text-align:right;">字段名称</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">列名称</td><td style="text-align:right;">是</td><td style="text-align:center;">触发条件描述</td></tr><tr><td style="text-align:right;">字段名称</td><td style="text-align:right;">是</td><td style="text-align:center;">必须来自实体表</td></tr><tr><td style="text-align:right;">支持过滤条件(多选)</td><td style="text-align:right;">否</td><td style="text-align:center;">操作符号，如:字段名称&gt;100 &lt;200</td></tr><tr><td style="text-align:right;">FlyCode数据源Code：</td><td style="text-align:right;">否</td><td style="text-align:center;">字典值，不如合格,不合格。</td></tr></tbody></table><p>赋值目标：</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E5%AE%9E%E4%BD%93-%E8%B5%8B%E5%80%BC%E7%9B%AE%E6%A0%87.png" alt="&#39;积分实体-赋值目标&#39;"></p><p>字段解析:</p><table><thead><tr><th style="text-align:right;">字段名称</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">列名称</td><td style="text-align:right;">是</td><td style="text-align:center;">赋值目标描述，提交人/客户</td></tr><tr><td style="text-align:right;">赋值目标类型</td><td style="text-align:right;">是</td><td style="text-align:center;">通常可以有2种，提交人/客户</td></tr><tr><td style="text-align:right;">字段名称(多选)</td><td style="text-align:right;">是</td><td style="text-align:center;">提交人/客户对应实体表的字段,必须和DB 属性一致</td></tr></tbody></table><p>赋值目标备注: 6.0智慧100 产品，只做了赋值给人员的积分明细、积分统计，赋值给客户的项目如果需要，报表统计这块要自己开发。</p><p>2.2 积分模板配置<br> 名词解析，什么是积分指标? 积分指标即：作为衡量标准的载体，如:订单指标，铺货指标。<br> 积分模板的配置是基于积分实体的，模板按类型可以分为单次,累计，单次异步。其中单次只能选择单次积分实体（ide 实体）。累计/异步可以选择‘非ide实体’.<br> 特别需要注意:<br> (1) 单次积分实体(ide实体)，可以被多个积分指标复用。但是非ide 实体(累计/异步)必须和积分模板一对一。<br> (2) 单次积分，指标名称可以和实体名称不一致，可以自定义名称(强烈建议英文,后面会被SPU 或者di 中作为重要标识使用.)。但累计/异步积分，指标名称默认和积分对象名称一致，无法修改。<br> (3) 单次积分没有异步运算方法(存储函数),累计/异步有异步运算方法。该函数为di 调度服务，调用该function 汇聚数据使用。eg:汇总用户每日拜访次数，每日订单金额总数。function 必须是实际已经存在的。<br> (4) 修改指标信息之后，需要发布该指标，否则信息不会被修改.<br> (5) 指标计算字段，指标触发条件字段，指标赋值字段来自于积分实体。<br> 具体配置信息如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E6%8C%87%E6%A0%87-%E6%8C%87%E6%A0%87%E9%A1%B9.png" alt="&#39;积分指标-指标项&#39;"></p><h2 id="三、-积分规则-积分方案设置" tabindex="-1">三、 积分规则，积分方案设置 <a class="header-anchor" href="#三、-积分规则-积分方案设置" aria-label="Permalink to &quot;三、 积分规则，积分方案设置&quot;">​</a></h2><p>积分规则，积分方案设定在web 端积分管理模块中配置. 积分规则依赖于积分指标模板，积分方案依赖于积分规则.</p><p>3.1 积分规则<br> 积分规则按照类型有2中，单次和累计。其中单次配置包括单次积分，单次异步的配置. 积分规则配置非常类似，这里以单次积分为例子说明.<br> 注意事项:<br> (1)累计配置包括累计积分的配置。单次配置为单次积分/单次异步规则配置。这里强调，单次积分规则只能选择单次积分/异步模板，累计积分规则只能选择累计积分模板,无法交叉。<br> (2)新增触发条件不会新增规则，内部条件关系为AND 关系，但是新增规则操作，会新增规则，不同规则之间是OR 关系。获取的积分会累计.<br> 具体积分规则设置如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E8%A7%84%E5%88%99-%E8%A7%84%E5%88%99%E8%AE%BE%E7%BD%AE.png" alt="&#39;积分规则-规则设置&#39;"></p><p>字段解析:</p><table><thead><tr><th style="text-align:right;">字段名称</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">规则名称</td><td style="text-align:right;">是</td><td style="text-align:center;">规则名称</td></tr><tr><td style="text-align:right;">积分描述</td><td style="text-align:right;">是</td><td style="text-align:center;">用户清晰表达该规则是用来做什么的</td></tr><tr><td style="text-align:right;">适用组织</td><td style="text-align:right;">是</td><td style="text-align:center;">标志该积分规则的一个适用范围</td></tr><tr><td style="text-align:right;">积分指标</td><td style="text-align:right;">是</td><td style="text-align:center;">依赖哪一个积分指标</td></tr><tr><td style="text-align:right;">积分对象</td><td style="text-align:right;">是</td><td style="text-align:center;">积分赋值在人员还是客户身上.单选</td></tr><tr><td style="text-align:right;">积分规则</td><td style="text-align:right;">是</td><td style="text-align:center;">积分规则配置的核心,获取积分的条件</td></tr><tr><td style="text-align:right;">积分规则-获得积分</td><td style="text-align:right;">是</td><td style="text-align:center;">可以是具体值，也可以是可供计算属性组成的表达式 eg:(可供计算属性A+可供计算属性B)*0.5</td></tr><tr><td style="text-align:right;">每次积分上限</td><td style="text-align:right;">是</td><td style="text-align:center;">可限制每次触发获取积分的上限，单次积分/单次异步适用，累计积分没有该属性</td></tr><tr><td style="text-align:right;">每天次数上限</td><td style="text-align:right;">是</td><td style="text-align:center;">可限制每天触发获取积分的次数上限，单次积分/单次异步适用，累计积分没有该属性</td></tr><tr><td style="text-align:right;">每天积分上限</td><td style="text-align:right;">是</td><td style="text-align:center;">每天获取积分上限，均适用</td></tr></tbody></table><p>3.2 积分方案设置<br> 积分方案依赖于积分规则，积分方案不存在单次，累计的说法，可以选择多个积分规则，但是请特别注意:<br> (1) 同一个方案同一个积分指标的积分规则不能有多个。比如 规则A ，规则B 都依赖积分指标A1 ,这2个指标不能多选。<br> (2) 二个相同营销组织(适用范围)的有效方案，也不允许(1) 的出现。<br> (3) 积分方案适用范围可以是:厂家,经销商营销组织(支持多选),应用维度可以是组织+职位(支持多选)，也可以是组织+人员(支持多选)。<br> (4) 厂家,经销商营销组织至少填写一项。<br> (5) 匹配积分方案计算积分时,大组织+职位&lt;小组织+职位的方式。比如铺货这个指标在广东公司有方案，在广州也有方案，则匹配广州地区的方案进行积分计算。如果广州不存在方案，则向上查询。<br> (6) 积分方案存在如下状态.草稿-待生效-进行中-已结束。状态变化过程如下:<br> 新建方案-草稿。发布方案，待生效。到了方案开始时间-进行中。方案结束-已结束。<br> (7)方案生效状态。默认为有效，无论(5)中方案处于何种状态，都可以立即停止使用(逻辑删除)。</p><p>具体积分方案设置如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%A7%AF%E5%88%86%E6%96%B9%E6%A1%88.png" alt="&#39;积分方案&#39;"></p><h2 id="四、程序中做扩展接入" tabindex="-1">四、程序中做扩展接入 <a class="header-anchor" href="#四、程序中做扩展接入" aria-label="Permalink to &quot;四、程序中做扩展接入&quot;">​</a></h2><p>以上1-3 点均为积分的基础内容，下面针对积分体系程序扩展接入进行演示. 内容包括，从0-1 扩展接入单次积分，累计积分(至于异步积分类似操作)。</p><p>4.1 单次积分扩展演示</p><p>这里以铺货作为指标，需求：每次铺货合格 + 5分<br> (1) 积分实体配置<br> 找到铺货业务表，kx_distribution_collect.要选择是ide 实体(为单次积分实体)。 然后思考触发条件属性，可供计算属性，赋值目标有哪些属性值。<br><strong>\`\`<code>需要强调的是：作为单次积分实体（Ide实体）的业务表，必须包含字段名为‘id’的唯一值字段(通常为主键),eg:kx_distribution_collect 主键为id ，否则无法计算积分。</code>\`\`</strong><br> 详细配置如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E5%AE%9E%E4%BD%93.png" alt="&#39;铺货-实体&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E5%8F%AF%E4%BE%9B%E8%AE%A1%E7%AE%97.png" alt="&#39;铺货-可供计算&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6.png" alt="&#39;铺货-触发条件&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E5%AE%9E%E4%BD%93.png" alt="&#39;铺货-赋值目标&#39;"></p><p>(2) 积分指标配置</p><p>配好实体，配置积分指标。按照前面的描述配置，比如，选择指标类型为单次，选择铺货对象实体。根据实际需要勾选指标计算属性.<br> 特别注意: 这里不能配置异步运算方法<br> 具体配置如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E7%A7%AF%E5%88%86%E6%8C%87%E6%A0%87.png" alt="&#39;铺货-积分指标&#39;"></p><p>(3) 积分规则配置</p><p>具体配置如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E7%A7%AF%E5%88%86%E8%A7%84%E5%88%99.png" alt="&#39;铺货-积分规则&#39;"></p><p>(4) 积分方案配置</p><p>填写方案名称，描述。方案开始，结束时间。适用范围(厂家，经销商)，应用范围(组织+职位/人员)。选择4.3 配置的积分规则等信息。<br> 特别注意: 保存方案之后，需要点击发布按钮进行发布方案.</p><p>具体配置如下:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%93%BA%E8%B4%A7-%E7%A7%AF%E5%88%86%E6%96%B9%E6%A1%88.png" alt="&#39;铺货-积分方案&#39;"></p><p>(5) 积分计算</p><p>如何触发积分计算，比如用户铺货合格了，如何触发?<br> 对于单次积分,在aPaaS IDE上我们提供了SPU 智慧插件,后续对SPU在进行详细说明.这里演示如何调用SPU 插件.</p><p>function callIntegralSpu(execId){<br> var integralParam = {<br> &quot;integral_params&quot;: {<br> &quot;object_name&quot;: &quot;kx_dis_collect_isperfect&quot;, // 积分指标名称<br> &quot;object_id&quot;: execId + &#39;&#39;// execId 业务数据id，这里是铺货表数据铺货数据id<br> }<br> }<br> FLY.call(&#39;memberIntegral.integral_single_execute&#39;, integralParam);<br> }</p><p>4.2 累计积分扩展演示</p><p>累计积分以每日拜访次数为案例,需求:每日拜访10-15次，获得5分；拜访大于15次，每多拜访1家得0.5分；每天最高10分.<br> 配置积分实体之前，先自定义实体表，累计积分相对比较灵活，通常在拜访事实表,或者实际拜访表都记录了拜访的数据,我们要创建积分实体表，用来汇聚数据（具体通过积分指标配置的function 汇聚）。</p><p>(1) 定义积分实体表 kx_visit_workrecord_exec<br> 主要字段解析：</p><table><thead><tr><th style="text-align:right;">字段名称</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">拜访日期</td><td style="text-align:right;">是</td><td style="text-align:center;">按照日统计积分</td></tr><tr><td style="text-align:right;">成员id</td><td style="text-align:right;">是</td><td style="text-align:center;">赋值对象是谁</td></tr><tr><td style="text-align:right;">适用组织</td><td style="text-align:right;">是</td><td style="text-align:center;">标志该积分规则的一个适用范围</td></tr><tr><td style="text-align:right;">拜访内容</td><td style="text-align:right;">是</td><td style="text-align:center;">从实际拜访表汇聚过来</td></tr><tr><td style="text-align:right;">创建人(createop)</td><td style="text-align:right;">是</td><td style="text-align:center;">和成员id一样.单选</td></tr><tr><td style="text-align:right;">创建时间(createtime)</td><td style="text-align:right;">是</td><td style="text-align:center;"></td></tr><tr><td style="text-align:right;">修改人(updateop)</td><td style="text-align:right;">是</td><td style="text-align:center;">修改人</td></tr><tr><td style="text-align:right;">修改时间(updatetime)</td><td style="text-align:right;">是</td><td style="text-align:center;">修改时间</td></tr><tr><td style="text-align:right;">每天次数上限</td><td style="text-align:right;">是</td><td style="text-align:center;">可限制每天触发获取积分的次数上限，单次积分/单次异步适用，累计积分没有该属性</td></tr><tr><td style="text-align:right;">处理状态(handledstatus)</td><td style="text-align:right;">是</td><td style="text-align:center;">0：为计算积分 1：已经计算积分</td></tr><tr><td style="text-align:right;">积分处理失败信息(integralremark)</td><td style="text-align:right;">是</td><td style="text-align:center;">处理情况，发生异常，会有log记录</td></tr><tr><td style="text-align:right;">营销组织(orgstructid)</td><td style="text-align:right;">是</td><td style="text-align:center;">成员所在营销组织</td></tr><tr><td style="text-align:right;">职位(positionid)</td><td style="text-align:right;">是</td><td style="text-align:center;">成员的职位</td></tr><tr><td style="text-align:right;">日期(datetime)</td><td style="text-align:right;">是</td><td style="text-align:center;">积分计算的日期，通常是di 调度的前一天.eg：该记录为 2022-06-08 di调度计算，该值为 2022-06-07</td></tr></tbody></table><p>具体信息如下：</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E6%8B%9C%E8%AE%BF%E8%AE%B0%E5%BD%95%E8%A1%A8.png" alt="&#39;拜访记录表&#39;"></p><p><strong>\`\`<code>特别注意:</code>\`\`</strong><br><strong>\`\`<code>以上红色框字段为非ide（累计积分/异步积分实体）固定字段(除成员id外),字段名称必须按照以上格式填写。</code>\`\`</strong></p><p>(2) 积分实体配置</p><p>注意：积分实体，选择是否ide 实体,填写否</p><p>具体配置如下(和铺货类似):</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E5%AF%B9%E8%B1%A1%E8%A1%A8.png" alt="&#39;累计-对象表&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E5%8F%AF%E4%BE%9B%E8%AE%A1%E7%AE%97.png" alt="&#39;累计-可供计算&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6.png" alt="&#39;累计-触发条件&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E8%B5%8B%E5%80%BC%E7%9B%AE%E6%A0%87.png" alt="&#39;累计-赋值目标&#39;"></p><p>(3) 积分指标配置<br> 这部分需要注意，累计/异步积分需要填写异步运算方法，该function 需要自主开发，用于把拜访事实表汇聚数据到拜访积分实体表(kx_visit_workrecord_exec)中。<br> 如下以积分指标配置和异步函数f_integral_visit_count_finish(&#39;&#39;)详情:</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E7%A7%AF%E5%88%86%E6%8C%87%E6%A0%87.png" alt="&#39;累计-积分指标&#39;"></p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0.png" alt="&#39;累计-异步函数&#39;"></p><p>(4) 积分规则配置</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E7%A7%AF%E5%88%86%E8%A7%84%E5%88%99.png" alt="&#39;累计-积分规则&#39;"></p><p>(5) 积分方案配置</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-%E7%A7%AF%E5%88%86%E6%96%B9%E6%A1%88.png" alt="&#39;累计-积分方案&#39;"></p><p>(6) 积分计算</p><p>累计/异步有2个di 调度服务。一个任务为:调用累计/单次异步的异步计算方法，即:function 汇总数据。另外一个任务:计算积分。<br> 积分di调度服务在di 平台上可以查询，运行.以下是演示环境的2个任务，也可以查看1000060 等租户的任务。</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%B4%AF%E8%AE%A1-di%E8%B0%83%E5%BA%A6.png" alt="&#39;累计-di调度&#39;"></p><p>综上: 累计/单次异步积分由di 调度服务处理，不需要开发人员手动调用。而单次积分则需要手动调用SPU 智慧插件触发</p><h2 id="五、积分spu智慧插件使用" tabindex="-1">五、积分SPU智慧插件使用 <a class="header-anchor" href="#五、积分spu智慧插件使用" aria-label="Permalink to &quot;五、积分SPU智慧插件使用&quot;">​</a></h2><p>apaas平台 ide 已经集成aPaaS SPU 插件。SPU 积分插件已经集成。</p><p>5.1 api文档：</p><p>入参：</p><table><thead><tr><th style="text-align:right;">字段</th><th style="text-align:right;">名称</th><th style="text-align:right;">类型</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">objectName</td><td style="text-align:right;">积分指标名称</td><td style="text-align:right;">string</td><td style="text-align:right;">是</td><td style="text-align:center;">在配置中心-积分指标模板配置积分指标</td></tr><tr><td style="text-align:right;">objectId</td><td style="text-align:right;">积分实体对象id值</td><td style="text-align:right;">string</td><td style="text-align:right;">是</td><td style="text-align:center;">在id 数据插入所在事务提交之后调用插件，保证积分正常计算</td></tr></tbody></table><p>出参：</p><table><thead><tr><th style="text-align:right;">字段</th><th style="text-align:right;">名称</th><th style="text-align:right;">类型</th><th style="text-align:right;">是否必填</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:right;">Response</td><td style="text-align:right;">响应结果</td><td style="text-align:right;">LIST</td><td style="text-align:right;">否</td><td style="text-align:center;">正常返回Response对象，说明调用成功。如果服务异常，会抛出error</td></tr></tbody></table><p>5.2 IDE 中调用</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>          function callIntegralSpu(execId){ </span></span>
<span class="line"><span>                  var integralParam = {</span></span>
<span class="line"><span>                      &quot;integral_params&quot;: {</span></span>
<span class="line"><span>                          &quot;object_name&quot;: &quot;kx_dis_collect_isperfect&quot;, // 积分指标名称</span></span>
<span class="line"><span>                          &quot;object_id&quot;: execId + &#39;&#39;// execId 业务数据&#39;id&#39;值(再次强调主键字段名称必须为&#39;id&#39;)，这里是铺货表数据铺货数据id值</span></span>
<span class="line"><span>                      }</span></span>
<span class="line"><span>                  }</span></span>
<span class="line"><span>                  FLY.call(&#39;memberIntegral.integral_single_execute&#39;, integralParam);</span></span>
<span class="line"><span>              }</span></span>
<span class="line"><span>         // memberIntegral.integral_single_execute 细节.</span></span>
<span class="line"><span>         /**</span></span>
<span class="line"><span>          * 智慧100 v6.0 单次积分业务提交,积分计算</span></span>
<span class="line"><span>          * memberIntegral.integral_single_execute</span></span>
<span class="line"><span>         */</span></span>
<span class="line"><span>         if(String.isBlank(IN.integral_params.object_name)||String.isBlank(IN.integral_params.object_id)){</span></span>
<span class="line"><span>             throw new ERROR(&#39;【积分指标名称】【积分对象id值】必须填写!&#39;);</span></span>
<span class="line"><span>         }</span></span>
<span class="line"><span>         try{</span></span>
<span class="line"><span>             var SFA_Service = PLUGIN.load(&quot;SFA_Service&quot;);</span></span>
<span class="line"><span>             var SERVER_1 = SFA_Service.get(&quot;integralPlugin&quot;);</span></span>
<span class="line"><span>             var HashMap = java.util.HashMap;</span></span>
<span class="line"><span>             var map = new HashMap();</span></span>
<span class="line"><span>             map.put(&quot;objectName&quot;, IN.integral_params.object_name+&quot;&quot;);</span></span>
<span class="line"><span>             map.put(&quot;objectId&quot;, IN.integral_params.object_id+&quot;&quot;); // objectId 为kx_cost_display_exec表的id 值 </span></span>
<span class="line"><span>             var res = SERVER_1.singleIntegralCalculate(0, map);</span></span>
<span class="line"><span>             FLY.log(&#39;res-&gt;&#39; + res);</span></span>
<span class="line"><span>         }catch(e){</span></span>
<span class="line"><span>             FLY.log(&#39;积分计算失败,原因是:&#39;+e);</span></span>
<span class="line"><span>             throw new ERROR(e);</span></span>
<span class="line"><span>         }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div>`,90);function o(b,x,E,y,u,m){const e=s("font");return l(),p("div",null,[c,i("p",null,[t("(1)积分按类型可以分为三种："),r(e,null,{default:d(()=>[t("单次积分,累计积分,单次异步。")]),_:1})]),h])}const B=n(g,[["render",o]]);export{_ as __pageData,B as default};
