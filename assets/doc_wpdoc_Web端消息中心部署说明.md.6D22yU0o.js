import{_ as s,o as a,c as i,R as n}from"./chunks/framework.S1SDgkSw.js";const g=JSON.parse('{"title":"Web端消息中心部署说明","description":"","frontmatter":{"title":"Web端消息中心部署说明","date":"2021-12-14T10:53:51.000Z"},"headers":[],"relativePath":"doc/wpdoc/Web端消息中心部署说明.md","filePath":"doc/wpdoc/Web端消息中心部署说明.md"}'),e={name:"doc/wpdoc/Web端消息中心部署说明.md"},t=n(`<h1 id="web端消息中心部署说明" tabindex="-1">Web端消息中心部署说明 <a class="header-anchor" href="#web端消息中心部署说明" aria-label="Permalink to &quot;Web端消息中心部署说明&quot;">​</a></h1><h2 id="_1、服务更新" tabindex="-1">1、服务更新 <a class="header-anchor" href="#_1、服务更新" aria-label="Permalink to &quot;1、服务更新&quot;">​</a></h2><p>1.1、web：V9.5.0及以上版本</p><p>1.2、messageserv：2.10.0及以上版本</p><p>1.3、offline-engine：2.10.0及以上版本</p><h2 id="_2、租户库中执行以下sql" tabindex="-1">2、租户库中执行以下SQL <a class="header-anchor" href="#_2、租户库中执行以下sql" aria-label="Permalink to &quot;2、租户库中执行以下SQL&quot;">​</a></h2><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;public&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pl_msgticket&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;isread&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> int4;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="_3、导入业务领域" tabindex="-1">3、导入业务领域 <a class="header-anchor" href="#_3、导入业务领域" aria-label="Permalink to &quot;3、导入业务领域&quot;">​</a></h2><p>导入业务行为JSON【业务行为-通知公告详情1-消息中心.json】</p><p>SVN路径：<a href="https://xwsvn.wxchina.com/doc/aPaaS/V3.3/%E6%96%87%E6%A1%A3/%E6%9B%B4%E6%96%B0%E8%84%9A%E6%9C%AC.zip" target="_blank" rel="noreferrer">https://xwsvn.wxchina.com/doc/aPaaS/V3.3/文档/更新脚本.zip</a></p><h2 id="_4、导入表单页面" tabindex="-1">4、导入表单页面 <a class="header-anchor" href="#_4、导入表单页面" aria-label="Permalink to &quot;4、导入表单页面&quot;">​</a></h2><p>导入业务UI文件【业务UI-消息中心.json】、【业务UI-通知公告查看详情.json】</p><p>SVN路径：<a href="https://xwsvn.wxchina.com/doc/aPaaS/V3.3/%E6%96%87%E6%A1%A3/%E6%9B%B4%E6%96%B0%E8%84%9A%E6%9C%AC.zip" target="_blank" rel="noreferrer">https://xwsvn.wxchina.com/doc/aPaaS/V3.3/文档/更新脚本.zip</a></p><h2 id="_5、配置nginx" tabindex="-1">5、配置nginx <a class="header-anchor" href="#_5、配置nginx" aria-label="Permalink to &quot;5、配置nginx&quot;">​</a></h2><p>进入nginx配置文件所在路径，一般是在/usr/local/openresty/nginx/conf</p><p>打开nginx.conf并找到 listen 7000;</p><p>加上以下配置信息：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~^/api/teapi/message</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $jwtok </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   access_by_lua_file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/usr/local/openresty/nginx/scripts/apaas_jwtdecode_withoutcheck.lua&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://apaastomcat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ^/api/teapi/message/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">+) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/messageserv/</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>配置完成后效果如下：</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/nginx%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C%E6%88%AA%E5%9B%BE.png" alt="nginx配置结果截图"></p><p>重启nginx、backend、offline-engine，刷新前端。</p><p>另附V3.3的发布阶段的压缩包，<a href="http://apaas.wxchina.com:8881/wp-content/uploads/V3.3%E5%8F%91%E5%B8%83%E9%98%B6%E6%AE%B5%E5%8E%8B%E7%BC%A9%E5%8C%85.zip" title="V3.3发布阶段压缩包" target="_blank" rel="noreferrer">点此下载</a>。</p>`,22),p=[t];function l(h,r,k,o,d,c){return a(),i("div",null,p)}const b=s(e,[["render",l]]);export{g as __pageData,b as default};
