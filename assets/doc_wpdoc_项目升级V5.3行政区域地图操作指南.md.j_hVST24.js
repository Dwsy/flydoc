import{_ as s,c as i,o as a,U as n}from"./chunks/framework.FhXPyWfz.js";const _=JSON.parse('{"title":"项目升级V5.3行政区域地图操作指南","description":"","frontmatter":{"title":"项目升级V5.3行政区域地图操作指南","date":"2023-06-14T11:59:13.000Z"},"headers":[],"relativePath":"doc/wpdoc/项目升级V5.3行政区域地图操作指南.md","filePath":"doc/wpdoc/项目升级V5.3行政区域地图操作指南.md"}'),e={name:"doc/wpdoc/项目升级V5.3行政区域地图操作指南.md"},l=n(`<h1 id="一、需要的文件-文章底部下载" tabindex="-1">一、需要的文件（文章底部下载） <a class="header-anchor" href="#一、需要的文件-文章底部下载" aria-label="Permalink to &quot;一、需要的文件（文章底部下载）&quot;">​</a></h1><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16867134196597.png" alt=""></p><h1 id="二、数据库的表替换" tabindex="-1">二、数据库的表替换 <a class="header-anchor" href="#二、数据库的表替换" aria-label="Permalink to &quot;二、数据库的表替换&quot;">​</a></h1><ol><li>执行以下操作前，请先将数据库相关表进行备份</li></ol><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ka_kq_channelcustomers_bak1106 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ka_kq_channelcustomers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kx_kq_ka_bak1106 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kx_kq_ka</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kx_kq_store_bak1106 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kx_kq_store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pl_region_bak1106 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pl_region</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li><p>找到项目所在的数据库，右键表，运行SQL文件，选择上面的pl_region.sql文件。完成行政区域表的替换。</p></li><li><p>同样操作，运行SQL文件，选择上面的map_changes.sql文件。创建map_changes表。运行完可以查看，表里存的是替换前；后差异的数据，共347条行政区域数据发生了变化。这里主要指的regionid发生变化的，因为库里的业务表里一般存的都是regionid。</p></li><li><p>下一步要做的就是将业务表里发生改变的regionid替换过来。遍历业务表数据，替换regionid存在在map_changes里的数据，替换为map_changes里的regionid_new。</p><ul><li><strong>例</strong>：</li></ul><p><code>UPDATE user_info u set code = m.regionid_new from map_changes m where u.code=m.regionid;</code></p></li></ol><ul><li><strong>终端管理</strong>：</li></ul><p><code>UPDATE kx_kq_store k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</code></p><ul><li><strong>费用归属经销商和供货批发商</strong>1. ：</li></ul><p><code>UPDATE ka_kq_channelcustomers k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</code></p><ul><li><strong>KA系统管理</strong>:</li></ul><p><code>UPDATE kx_kq_ka k set regionid = m.regionid_new from map_changes m where k. regionid =m.regionid;</code></p><h1 id="三、替换json文件" tabindex="-1">三、替换json文件 <a class="header-anchor" href="#三、替换json文件" aria-label="Permalink to &quot;三、替换json文件&quot;">​</a></h1><p>Xshell工具，Linux服务器地址47.115.23.83 用户名root 密码UsMXdz5gtBc7-G</p><p>找到服务器的/home/apaas/web/static/regionMap/map路径，把底下的所有json删除：</p><p>具体指令操作：</p><p>l. 查看是否有json文件</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/apaas/web/static/regionMap/map</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//服务器路径</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol><li>删除json文件</li></ol><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/apaas/web/static/regionMap/map</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3.上传本地解压好的json文件，注意可能由于操作工具限制，文件上传数量有限制，可能需要分2-3次上传，并再次</p><p>4.查看文件名是否乱码（使用xshell的不会乱码）</p><p>上传成功后，请查看json文件名是否为正常中文字符显示，若xShell中文件名出现乱码，可能存在编码问题，导致文件执行不成功。</p><h1 id="四、大屏地图替换" tabindex="-1">四、大屏地图替换 <a class="header-anchor" href="#四、大屏地图替换" aria-label="Permalink to &quot;四、大屏地图替换&quot;">​</a></h1><p>另外全部执行完后，在终端分布图显示需要用到一个bi_dim_region业务表，需要再运行bi_dim_region.sql文件，将bi_dim_region表数据替换，</p><p>替换完成后可以登陆web页面，“统计报表”目录下的“终端分布图”、“渠道分布图”查看地图是否显示正常。</p><h1 id="五、注意事项" tabindex="-1">五、注意事项 <a class="header-anchor" href="#五、注意事项" aria-label="Permalink to &quot;五、注意事项&quot;">​</a></h1><p>假如终端分布图里点击某一个地图没有反应，没有进入到下一级。说明对应的json有问题，定位替换那一个就行了。比如点北京市没反应，就检查”中国.北京.json”这个文件。</p><p>附件下载地址：<br> 项目更新现有最新行政区域<br><a href="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%A1%B9%E7%9B%AE%E5%8D%87%E7%BA%A7V5.3%E8%A1%8C%E6%94%BF%E5%8C%BA%E5%9F%9F%E5%9C%B0%E5%9B%BE%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97.zip" title="项目升级V5.3行政区域地图操作指南" target="_blank" rel="noreferrer">项目升级V5.3行政区域地图操作指南</a></p>`,29),p=[l];function t(r,h,o,d,k,c){return a(),i("div",null,p)}const m=s(e,[["render",t]]);export{_ as __pageData,m as default};
