import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.b1e56e49.js";const b=JSON.parse('{"title":"3.4.3. Excel-flycode导入","description":"","frontmatter":{"title":"3.4.3. Excel-flycode导入","date":"2020-09-10T13:50:15.000Z"},"headers":[],"relativePath":"doc/wpdoc/3.4.3. Excel-flycode导入.md","filePath":"doc/wpdoc/3.4.3. Excel-flycode导入.md"}'),p={name:"doc/wpdoc/3.4.3. Excel-flycode导入.md"},o=l(`<h1 id="_3-4-3-excel导入" tabindex="-1">3.4.3 Excel导入 <a class="header-anchor" href="#_3-4-3-excel导入" aria-label="Permalink to &quot;3.4.3 Excel导入&quot;">​</a></h1><ul><li><p><a href="#333-Excel导入">3.3.3 导入导出</a></p><ul><li><p><a href="#3331-excel导入">3.3.3.1 Excel导入</a></p><ul><li><a href="#33311-Excel导入过程分解">3.3.3.1.1 Excel导入过程分解</a></li><li><a href="#33312-Excel导入API">3.3.3.1.2 Excel导入API</a></li><li><a href="#33313-场景例子">3.3.3.1.3 Excel导入场景例子</a></li></ul></li></ul></li></ul><h2 id="_3-4-3-1-excel导入" tabindex="-1">3.4.3.1 Excel导入 <a class="header-anchor" href="#_3-4-3-1-excel导入" aria-label="Permalink to &quot;3.4.3.1 Excel导入&quot;">​</a></h2><ol><li>支持由实施自行组织，批量提交数据</li><li>支持临时表方式导入，从临时表中获取异常数据输出excel</li><li>支持主从数据导入，主与从数据，由开发都根据数据行判断，进行批量提交</li><li>支持多个sheet页不同逻辑处理</li><li>支持前端导入，直接把excel数据经过flycode转换后，输出为列表，用于表单控件绑定（编辑表格）</li><li>导入时，附加额外入参</li><li>支持flycode中变量，用于缓存一些转换数据处理，不需要每条数据，都查询</li><li>界面优化，每次点击导入，弹出当前进度页面</li><li>支持复杂多级列头定义</li><li>支持规范列头和非规范列头导入</li><li>支持原生语句提交，非提交的，可以用以前的flycode方式查询</li></ol><h3 id="_3-4-3-1-1-excel导入过程分解" tabindex="-1">3.4.3.1.1 Excel导入过程分解 <a class="header-anchor" href="#_3-4-3-1-1-excel导入过程分解" aria-label="Permalink to &quot;3.4.3.1.1 Excel导入过程分解&quot;">​</a></h3><ul><li>执行过程图</li></ul><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E6%96%B0%E5%AF%BC%E5%85%A5-1.png" alt=""></p><ul><li>入参介绍</li></ul><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;impfile&quot;</span><span style="color:#E1E4E8;">:{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;sheetnames&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;[</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">CC客户</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#6A737D;">//导入选择的sheet</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;fileurl&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;c99/att/20200611/1008212/c991daca-a19c-4fd8-8759-fc02d637a96d.xlsx&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#6A737D;">//导入文件url</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;filename&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;TT客户.xlsx&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#6A737D;">//导入的文件名</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">&quot;_dupstrategy&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;1&quot;</span><span style="color:#6A737D;">//导入策略 1 覆盖 2 追加 3 放弃</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;customer-param&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//自定义入参， IDE中定义的入参对象</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;impfile&quot;</span><span style="color:#24292E;">:{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;sheetnames&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;[</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">CC客户</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]&quot;</span><span style="color:#24292E;">,</span><span style="color:#6A737D;">//导入选择的sheet</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;fileurl&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;c99/att/20200611/1008212/c991daca-a19c-4fd8-8759-fc02d637a96d.xlsx&quot;</span><span style="color:#24292E;">,</span><span style="color:#6A737D;">//导入文件url</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;filename&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;TT客户.xlsx&quot;</span><span style="color:#24292E;">,</span><span style="color:#6A737D;">//导入的文件名</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">&quot;_dupstrategy&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#6A737D;">//导入策略 1 覆盖 2 追加 3 放弃</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;customer-param&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//自定义入参， IDE中定义的入参对象</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_3-4-3-1-2-excel导入api" tabindex="-1">3.4.3.1.2 Excel导入API <a class="header-anchor" href="#_3-4-3-1-2-excel导入api" aria-label="Permalink to &quot;3.4.3.1.2 Excel导入API&quot;">​</a></h3><ul><li>加载</li></ul><p>初始化加载导入处理类</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//加载导入处理类 EXCELIMP</span></span>
<span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//加载导入处理类 EXCELIMP</span></span>
<span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>获取当前导入的批次id</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//批次号获取</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> dynamicid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.dynamicid;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//批次号获取</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> dynamicid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.dynamicid;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>入参获取</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//入参</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> inParam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getInputParam</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//入参</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> inParam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getInputParam</span><span style="color:#24292E;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>导入策略获取</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//导入策略</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _dupstrategy </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> inParam.impfile._dupstrategy;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//导入策略</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _dupstrategy </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> inParam.impfile._dupstrategy;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>列头设置映射</li></ul><p>设置导入的excel中，列头与数据表列的映射关系</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> titlemappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [{</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品编码&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productcode&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">}];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置标题映射</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setTitleMapping</span><span style="color:#E1E4E8;">(titlemappings);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> titlemappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [{</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品编码&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productcode&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">}];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置标题映射</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setTitleMapping</span><span style="color:#24292E;">(titlemappings);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>是否为前端导入</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//设置为前端导入模式</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setFrontImp</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//设置为前端导入模式</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setFrontImp</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>excel数据行处理函数注入 (必需)</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#6A737D;">/* 参数的介绍</span></span>
<span class="line"><span style="color:#6A737D;">exceldata：</span></span>
<span class="line"><span style="color:#6A737D;">规范列头是一个  Map&lt;String,Object&gt;，根据列头设置进行转换映射  如： {&quot;productname&quot;: &quot;A&quot;,&quot;procutcode&quot;: &quot;10001&quot;} </span></span>
<span class="line"><span style="color:#6A737D;">非规则列头是一个  List&lt;Object&gt;   [&quot;A&quot;,20,null,&quot;饮料&quot;]</span></span>
<span class="line"><span style="color:#6A737D;">customdata: 入参对象 与上面的 inParam 一样</span></span>
<span class="line"><span style="color:#6A737D;">sheetname: 当前数据所在sheet名称 </span></span>
<span class="line"><span style="color:#6A737D;">sheetrownum: 当前数据所在excel行数，注：规范列头时，是从真正数据开始的，非规范列头，是包括非规范列头开始计算。都是从0开始</span></span>
<span class="line"><span style="color:#6A737D;">rowdata:原excel数据 List&lt;Object&gt; [&quot;A&quot;,20,null,&quot;饮料&quot;]</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">rowdata</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//TODO 数据检查、生成提交的操作语句、忽略数据、错误数据、按批提交数据</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#6A737D;">/* 参数的介绍</span></span>
<span class="line"><span style="color:#6A737D;">exceldata：</span></span>
<span class="line"><span style="color:#6A737D;">规范列头是一个  Map&lt;String,Object&gt;，根据列头设置进行转换映射  如： {&quot;productname&quot;: &quot;A&quot;,&quot;procutcode&quot;: &quot;10001&quot;} </span></span>
<span class="line"><span style="color:#6A737D;">非规则列头是一个  List&lt;Object&gt;   [&quot;A&quot;,20,null,&quot;饮料&quot;]</span></span>
<span class="line"><span style="color:#6A737D;">customdata: 入参对象 与上面的 inParam 一样</span></span>
<span class="line"><span style="color:#6A737D;">sheetname: 当前数据所在sheet名称 </span></span>
<span class="line"><span style="color:#6A737D;">sheetrownum: 当前数据所在excel行数，注：规范列头时，是从真正数据开始的，非规范列头，是包括非规范列头开始计算。都是从0开始</span></span>
<span class="line"><span style="color:#6A737D;">rowdata:原excel数据 List&lt;Object&gt; [&quot;A&quot;,20,null,&quot;饮料&quot;]</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">,</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">,</span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">,</span><span style="color:#E36209;">rowdata</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//TODO 数据检查、生成提交的操作语句、忽略数据、错误数据、按批提交数据</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>sheet开始读取数据处理函数注入 (非必要)</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/* 参数介绍</span></span>
<span class="line"><span style="color:#6A737D;">sheetname: 当前数据所在sheet名称</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sheetDataStartLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//TODO 变更列头映射</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setSheetDataStartLoopHandle</span><span style="color:#E1E4E8;">(sheetDataStartLoopHandle);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/* 参数介绍</span></span>
<span class="line"><span style="color:#6A737D;">sheetname: 当前数据所在sheet名称</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sheetDataStartLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//TODO 变更列头映射</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setSheetDataStartLoopHandle</span><span style="color:#24292E;">(sheetDataStartLoopHandle);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>sheet数据读取完毕处理函数注入 (非必要)</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/* 参数介绍</span></span>
<span class="line"><span style="color:#6A737D;">sheetname: 当前数据所在sheet名称</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sheetDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//TODO 把sheet或sheet余下数据 提交</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setSheetDataEndLoopHandle</span><span style="color:#E1E4E8;">(sheetDataEndLoopHandle);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/* 参数介绍</span></span>
<span class="line"><span style="color:#6A737D;">sheetname: 当前数据所在sheet名称</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sheetDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//TODO 把sheet或sheet余下数据 提交</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setSheetDataEndLoopHandle</span><span style="color:#24292E;">(sheetDataEndLoopHandle);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>整个excel数据读取完毕处理函数注入 (非必要)</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//TODO 做数据提交，或者什么都不处理 处理其他的非导入的功能。。如流程、发邮件、消息等</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelDataEndLoopHandle</span><span style="color:#E1E4E8;">(excelDataEndLoopHandle);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//TODO 做数据提交，或者什么都不处理 处理其他的非导入的功能。。如流程、发邮件、消息等</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelDataEndLoopHandle</span><span style="color:#24292E;">(excelDataEndLoopHandle);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>提交数据</li></ul><p>对导入的数据，进行按批，进行数据提交</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//数据提交参数 </span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> execsqls </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//提交的exceldata数据</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> exceldatas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> sql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;insert | update .....&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> param </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;id&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;xxx&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;xxxx&quot;</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> execsql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;sql&quot;</span><span style="color:#E1E4E8;">: sql, </span><span style="color:#9ECBFF;">&quot;param&quot;</span><span style="color:#E1E4E8;">: param};</span></span>
<span class="line"><span style="color:#E1E4E8;">execsqls.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(execsql);</span></span>
<span class="line"><span style="color:#E1E4E8;">exceldatas.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(rowdata);</span><span style="color:#6A737D;">//rowdata是来源于行数据的rowdata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//提交数据</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">commitData</span><span style="color:#E1E4E8;">(execsqls,exceldatas);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//数据提交参数 </span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> execsqls </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//提交的exceldata数据</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> exceldatas </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> sql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;insert | update .....&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> param </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;id&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;xxx&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;xxxx&quot;</span><span style="color:#24292E;">};</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> execsql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;sql&quot;</span><span style="color:#24292E;">: sql, </span><span style="color:#032F62;">&quot;param&quot;</span><span style="color:#24292E;">: param};</span></span>
<span class="line"><span style="color:#24292E;">execsqls.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(execsql);</span></span>
<span class="line"><span style="color:#24292E;">exceldatas.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(rowdata);</span><span style="color:#6A737D;">//rowdata是来源于行数据的rowdata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//提交数据</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">commitData</span><span style="color:#24292E;">(execsqls,exceldatas);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>忽略数据</li></ul><p>导入策略为放弃时，需要对已经存在的数据，标记 放弃导入</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//忽略处理</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">ignoreData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;放弃导入&quot;</span><span style="color:#E1E4E8;">, rowdata);</span><span style="color:#6A737D;">//rowdata是来源于行数据的rowdata</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//忽略处理</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">ignoreData</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;放弃导入&quot;</span><span style="color:#24292E;">, rowdata);</span><span style="color:#6A737D;">//rowdata是来源于行数据的rowdata</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>错误数据</li></ul><p>导入数据，数据检查有问题或有业务上检查出错，需要输出出错原因</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> errMsg </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;[产品名称]不能为空，是必填项&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">errRecord</span><span style="color:#E1E4E8;">(errMsg, rowdata);</span><span style="color:#6A737D;">//rowdata是来源于行数据的rowdata</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> errMsg </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;[产品名称]不能为空，是必填项&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">errRecord</span><span style="color:#24292E;">(errMsg, rowdata);</span><span style="color:#6A737D;">//rowdata是来源于行数据的rowdata</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>临时表处理结果输出</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//临时表名称</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> tempTableName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;kx_kq_product_temp&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//对临时表进行数据处理</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">dealTemplateData</span><span style="color:#E1E4E8;">(tempTableName);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelDataEndLoopHandle</span><span style="color:#E1E4E8;">(excelDataEndLoopHandle);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//临时表名称</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> tempTableName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;kx_kq_product_temp&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//对临时表进行数据处理</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">dealTemplateData</span><span style="color:#24292E;">(tempTableName);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelDataEndLoopHandle</span><span style="color:#24292E;">(excelDataEndLoopHandle);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>执行导入</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//执行数据导入</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//非规范列头导入 //excelRowDataHandle 传入的参数 exceldata 结构不一样</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;2&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//执行数据导入</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//非规范列头导入 //excelRowDataHandle 传入的参数 exceldata 结构不一样</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;2&quot;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-4-3-1-3-场景例子" tabindex="-1">3.4.3.1.3 场景例子 <a class="header-anchor" href="#_3-4-3-1-3-场景例子" aria-label="Permalink to &quot;3.4.3.1.3 场景例子&quot;">​</a></h3><ul><li>自行定义按批提交数据</li></ul><ol><li>可以自行在flycode上，处理一个计数器，定义多少条数据进行提交一次数据（每100条数据，进行一次提交）</li><li>有可能存在非整除的，就在 excelDataEndLoopHandle 中进行余下数据提交</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//提交数据计数器</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> excelrow </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">//提交批次数量</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> commitnum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel 数据</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> exceldatas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//数据提交参数 </span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> execsqls </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//数据提交处理</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">commitdata</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(execsqls </span><span style="color:#F97583;">!=</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> execsqls.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">commitData</span><span style="color:#E1E4E8;">(execsqls,exceldatas);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  exceldatas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">  execsqls </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">rowdata</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> check_res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">checkData</span><span style="color:#E1E4E8;">(exceldata,rowdata);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">check_res) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">errRecord</span><span style="color:#E1E4E8;">(check_res,rowdata);</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    excelrow</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//处理生成提交语句 execsqls 赋值</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">dealData</span><span style="color:#E1E4E8;">(exceldata, customdata,rowdata);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//每100条数据，进行提交数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(excelrow </span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> commitnum </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">commitdata</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//把余下的数据进行提交</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">commitdata</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelDataEndLoopHandle</span><span style="color:#E1E4E8;">(excelDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行导入</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//提交数据计数器</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> excelrow </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">//提交批次数量</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> commitnum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel 数据</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> exceldatas </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//数据提交参数 </span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> execsqls </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//数据提交处理</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">commitdata</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(execsqls </span><span style="color:#D73A49;">!=</span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> execsqls.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">commitData</span><span style="color:#24292E;">(execsqls,exceldatas);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  exceldatas </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">  execsqls </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">,</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">,</span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">,</span><span style="color:#E36209;">rowdata</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> check_res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">checkData</span><span style="color:#24292E;">(exceldata,rowdata);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">check_res) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">errRecord</span><span style="color:#24292E;">(check_res,rowdata);</span></span>
<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    excelrow</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//处理生成提交语句 execsqls 赋值</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">dealData</span><span style="color:#24292E;">(exceldata, customdata,rowdata);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//每100条数据，进行提交数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(excelrow </span><span style="color:#D73A49;">%</span><span style="color:#24292E;"> commitnum </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">commitdata</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//把余下的数据进行提交</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">commitdata</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelDataEndLoopHandle</span><span style="color:#24292E;">(excelDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行导入</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><ul><li>临时表场景</li></ul><ol><li><p>临时表导入方式，主要是解决大数据量数据导入，利用数据库的功能，作批量的数据检查。把非法的数据保留在<br> 临时表，作最终的错误数据的输出</p></li><li><p>根据errtype 输出 1 出错 2 忽略 数据 输出至 excel</p></li><li><p>临时表的结构，按列头定义映射建立数据表。另外，临时表结构要求，必须建立以下几个字段，用于输出出错数据所用</p></li></ol><table><thead><tr><th>字段中文</th><th>字段名</th><th>字段类型</th></tr></thead><tbody><tr><td>批次id</td><td>dynamicid</td><td>varchar 50</td></tr><tr><td>导入员</td><td>mbcode</td><td>int8</td></tr><tr><td>错误类型</td><td>errtype</td><td>int4</td></tr><tr><td>错误信息</td><td>errmsg</td><td>varchar</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//临时表名称</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> tempTableName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;kx_kq_product_temp&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> insertTempTableSQL </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;insert into ...&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//TODO 按批把excel数据写入至临时表 参考按批提交数据</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//标记临时表出错数据 //此部分可以调用存储过程来处理 //处理错误数据标记完成后</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//调用去处理生成临时表的出错数据输出 </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//SELECT * FROM &quot; + tempTableName + &quot; WHERE dynamicid = :dynamicid and mbcode = :mbcode and errtype &gt; 0; 分页输出错误数据至excel</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">dealTemplateData</span><span style="color:#E1E4E8;">(tempTableName);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelDataEndLoopHandle</span><span style="color:#E1E4E8;">(excelDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行导入</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//临时表名称</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> tempTableName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;kx_kq_product_temp&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> insertTempTableSQL </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;insert into ...&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//TODO 按批把excel数据写入至临时表 参考按批提交数据</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//标记临时表出错数据 //此部分可以调用存储过程来处理 //处理错误数据标记完成后</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//调用去处理生成临时表的出错数据输出 </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//SELECT * FROM &quot; + tempTableName + &quot; WHERE dynamicid = :dynamicid and mbcode = :mbcode and errtype &gt; 0; 分页输出错误数据至excel</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">dealTemplateData</span><span style="color:#24292E;">(tempTableName);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelDataEndLoopHandle</span><span style="color:#24292E;">(excelDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行导入</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li>主从数据导入场景</li></ul><ol><li>规范列头，如：订单与订单明细导入</li><li>以订单号作为一批数据，进行提交</li><li>以一个订单，对明细数据进行业务检查</li><li>对于一个订单数据，有业务错误，可通过出错记录API，进行处理</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//标题列映射定义 //定义了主表及明细表需要导入的数据列的映射关系</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> titlemappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;订单编号&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;ordercode&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;订单名称&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;ordername&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;客户名称&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;customername&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productname&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;价格&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;price&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;数量&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;amount&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置标题映射</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setTitleMapping</span><span style="color:#E1E4E8;">(titlemappings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//批次号获取</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> dynamicid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.dynamicid;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//临时变量定义</span></span>
<span class="line"><span style="color:#6A737D;">//主数据</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> masterdata </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#6A737D;">//明细数据</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> details </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据存储区</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> exceldatas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//执行语句的存储</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> execsqls </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> orderInsertSql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;insert mastertable ...&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> orderDetailInsertSql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;insert detailtable ....&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">batchCommitData</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">masterdata </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> details.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">//TODO 是由 masterdata和details  数据检查， 进行处理出execsqls 进行提交 </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">//var execsql =  {sql: &quot;&quot;,param:{}}; execsqls.push(execsql);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">commitData</span><span style="color:#E1E4E8;">(execsqls,exceldatas);</span><span style="color:#6A737D;">//是否能有事务处理？</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//清空</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterdata </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#E1E4E8;">    details </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">    exceldatas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">rowdata</span><span style="color:#E1E4E8;">)  {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//主从模式处理 //根据当前行的订单编码，判断是否为同一个订单数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">masterdata </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">masterdata[</span><span style="color:#9ECBFF;">&quot;ordercode&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#9ECBFF;">&quot;ordercode&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> masterdata[</span><span style="color:#9ECBFF;">&quot;ordercode&quot;</span><span style="color:#E1E4E8;">]) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//上一次的数据与当前的数据并非同一主数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">batchCommitData</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//如果没有数据问题，即把数据加入至临时变量</span></span>
<span class="line"><span style="color:#E1E4E8;">  masterdata</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;ordercode&quot;</span><span style="color:#E1E4E8;">: exceldata[</span><span style="color:#9ECBFF;">&quot;ordercode&quot;</span><span style="color:#E1E4E8;">], </span><span style="color:#9ECBFF;">&quot;ordername&quot;</span><span style="color:#E1E4E8;">: exceldata[</span><span style="color:#9ECBFF;">&quot;ordername&quot;</span><span style="color:#E1E4E8;">]};</span><span style="color:#6A737D;">//组装主数据表数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> detail </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> execldata;</span><span style="color:#6A737D;">//明细数据 自行组装处理需要字段，赋予 detail</span></span>
<span class="line"><span style="color:#E1E4E8;">  details.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(detail);</span></span>
<span class="line"><span style="color:#E1E4E8;">  exceldatas.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(rowdata);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行检查</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//把余下未提交的数据，进行提交 主从数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">batchCommitData</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//TODO 后续，可执行其他非导入处理</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行导入</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//标题列映射定义 //定义了主表及明细表需要导入的数据列的映射关系</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> titlemappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;订单编号&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;ordercode&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;订单名称&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;ordername&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;客户名称&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;customername&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productname&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;价格&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;price&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;数量&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;amount&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置标题映射</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setTitleMapping</span><span style="color:#24292E;">(titlemappings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//批次号获取</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> dynamicid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.dynamicid;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//临时变量定义</span></span>
<span class="line"><span style="color:#6A737D;">//主数据</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> masterdata </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#6A737D;">//明细数据</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> details </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据存储区</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> exceldatas </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//执行语句的存储</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> execsqls </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> orderInsertSql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;insert mastertable ...&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> orderDetailInsertSql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;insert detailtable ....&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">batchCommitData</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">masterdata </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> details.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">//TODO 是由 masterdata和details  数据检查， 进行处理出execsqls 进行提交 </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">//var execsql =  {sql: &quot;&quot;,param:{}}; execsqls.push(execsql);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">commitData</span><span style="color:#24292E;">(execsqls,exceldatas);</span><span style="color:#6A737D;">//是否能有事务处理？</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//清空</span></span>
<span class="line"><span style="color:#24292E;">    masterdata </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#24292E;">    details </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">    exceldatas </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">,</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">,</span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">,</span><span style="color:#E36209;">rowdata</span><span style="color:#24292E;">)  {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//主从模式处理 //根据当前行的订单编码，判断是否为同一个订单数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">masterdata </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">masterdata[</span><span style="color:#032F62;">&quot;ordercode&quot;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> exceldata[</span><span style="color:#032F62;">&quot;ordercode&quot;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> masterdata[</span><span style="color:#032F62;">&quot;ordercode&quot;</span><span style="color:#24292E;">]) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//上一次的数据与当前的数据并非同一主数据</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">batchCommitData</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//如果没有数据问题，即把数据加入至临时变量</span></span>
<span class="line"><span style="color:#24292E;">  masterdata</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;ordercode&quot;</span><span style="color:#24292E;">: exceldata[</span><span style="color:#032F62;">&quot;ordercode&quot;</span><span style="color:#24292E;">], </span><span style="color:#032F62;">&quot;ordername&quot;</span><span style="color:#24292E;">: exceldata[</span><span style="color:#032F62;">&quot;ordername&quot;</span><span style="color:#24292E;">]};</span><span style="color:#6A737D;">//组装主数据表数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> detail </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> execldata;</span><span style="color:#6A737D;">//明细数据 自行组装处理需要字段，赋予 detail</span></span>
<span class="line"><span style="color:#24292E;">  details.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(detail);</span></span>
<span class="line"><span style="color:#24292E;">  exceldatas.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(rowdata);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行检查</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//把余下未提交的数据，进行提交 主从数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">batchCommitData</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//TODO 后续，可执行其他非导入处理</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行导入</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><ul><li>前端导入场景</li></ul><p>用于小批量数据，用于直接把导入数据展示在表单上，进行编辑，再由表单，提交。如：订单明细导入、费用明细导入等。</p><ol><li>读取excel里数据，根据列头映射拿到excel数据，每行获取</li><li>根据输出的列表定义，把excel数据调整成，列表定义的输出字段 (相当于进行一个数据请求，一个列表输出)</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置为前端导入模式</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setFrontImp</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//标题列映射定义</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> titlemappings </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品编码&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productcode&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品名称&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productname&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品简称&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;shortname&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品品牌&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productbrand&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;建议零售价（元）&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;retailprice&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置标题映射</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setTitleMapping</span><span style="color:#E1E4E8;">(titlemappings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//结果数据</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> outdata </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> productnames </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">)  {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//读取exceldata转换为要输出的列表的数据集</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//业务处理 把excel数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  outdata.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(exceldata);</span></span>
<span class="line"><span style="color:#E1E4E8;">  productnames.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(exceldata[</span><span style="color:#9ECBFF;">&quot;productname&quot;</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">_f_imp_trans_data2map</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">objdatalist</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _obj_data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">objdatalist </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> objdatalist.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; _i</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">objdatalist.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">; _i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">          _obj_data[objdatalist[_i].text]</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">objdatalist[_i].key;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> _obj_data;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> dbProducts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//根据产品名称，进行查询数据库，查出产品id数据</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(productnames </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> productnames.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  dbProducts </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> select id </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">key</span><span style="color:#E1E4E8;">,productname </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">text</span><span style="color:#E1E4E8;">,productcode from kx_kq_product where productname </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> ({productnames}) norule;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> c_product_map </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">_f_imp_trans_data2map</span><span style="color:#E1E4E8;">(dbProducts);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> i</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> outdata.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//产品id赋值</span></span>
<span class="line"><span style="color:#E1E4E8;">  outdata[i].id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> c_product_map[outdata[i].productname];</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//列表输出</span></span>
<span class="line"><span style="color:#79B8FF;">OUT</span><span style="color:#E1E4E8;">.kx_kq_product </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> outdata;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置为前端导入模式</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setFrontImp</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//标题列映射定义</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> titlemappings </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品编码&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productcode&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品名称&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productname&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品简称&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;shortname&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品品牌&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productbrand&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;建议零售价（元）&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;retailprice&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置标题映射</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setTitleMapping</span><span style="color:#24292E;">(titlemappings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//结果数据</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> outdata </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> productnames </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">)  {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//读取exceldata转换为要输出的列表的数据集</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//业务处理 把excel数据</span></span>
<span class="line"><span style="color:#24292E;">  outdata.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(exceldata);</span></span>
<span class="line"><span style="color:#24292E;">  productnames.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(exceldata[</span><span style="color:#032F62;">&quot;productname&quot;</span><span style="color:#24292E;">]);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">_f_imp_trans_data2map</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">objdatalist</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _obj_data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">objdatalist </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> objdatalist.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _i </span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; _i</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">objdatalist.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">; _i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">          _obj_data[objdatalist[_i].text]</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">objdatalist[_i].key;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> _obj_data;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> dbProducts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#6A737D;">//根据产品名称，进行查询数据库，查出产品id数据</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(productnames </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> productnames.</span><span style="color:#005CC5;">length</span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  dbProducts </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> select id </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">key</span><span style="color:#24292E;">,productname </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">text</span><span style="color:#24292E;">,productcode from kx_kq_product where productname </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ({productnames}) norule;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> c_product_map </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">_f_imp_trans_data2map</span><span style="color:#24292E;">(dbProducts);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> i</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> outdata.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//产品id赋值</span></span>
<span class="line"><span style="color:#24292E;">  outdata[i].id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> c_product_map[outdata[i].productname];</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//列表输出</span></span>
<span class="line"><span style="color:#005CC5;">OUT</span><span style="color:#24292E;">.kx_kq_product </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> outdata;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><ul><li>多sheet页场景 (规范列头)</li></ul><p>解决不同sheet，不同列头，处理不同数据的导入</p><ol><li>sheet名称，不能随意调整</li><li>解决不同sheet列头导入。</li><li>可以在sheet变化时，重置列头映射</li><li>根据当前不同的sheet名称，进行不同的业务逻辑处理</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//sheet1 列头映射</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> titlemappings1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品编码&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productcode&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品名称&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productname&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//sheet2 列头映射</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> titlemapping2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;产品编码&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;productcode&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#9ECBFF;">&quot;column&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;建议零售价（元）&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;field&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;retailprice&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;String&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//sheet开始函数注入，动态调整列头映射</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sheetDataStartLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//处理的是把列头重置处理</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(sheetname </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;sheet1&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setTitleMapping</span><span style="color:#E1E4E8;">(titlemappings1);</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(sheetname </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;sheet2&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setTitleMapping</span><span style="color:#E1E4E8;">(titlemappings2);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setSheetDataStartLoopHandle</span><span style="color:#E1E4E8;">(sheetDataStartLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">,</span><span style="color:#FFAB70;">rowdata</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//数据检查 //根据不同sheetname，进行业务数据处理</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel sheet数据循环完毕</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sheetDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//把余下的sheet数据提交 </span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setSheetDataEndLoopHandle</span><span style="color:#E1E4E8;">(sheetDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//在此可以做数据提交，或者什么都不处理</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;==== excel data end loop handle ====&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//或者处理其他的非导入的功能。。如流程、发邮件、消息等</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelDataEndLoopHandle</span><span style="color:#E1E4E8;">(excelDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行数据导入</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//sheet1 列头映射</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> titlemappings1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品编码&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productcode&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品名称&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productname&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//sheet2 列头映射</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> titlemapping2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;产品编码&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;productcode&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#032F62;">&quot;column&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;建议零售价（元）&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;field&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;retailprice&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;String&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//sheet开始函数注入，动态调整列头映射</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sheetDataStartLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//处理的是把列头重置处理</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(sheetname </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;sheet1&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setTitleMapping</span><span style="color:#24292E;">(titlemappings1);</span></span>
<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(sheetname </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;sheet2&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setTitleMapping</span><span style="color:#24292E;">(titlemappings2);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setSheetDataStartLoopHandle</span><span style="color:#24292E;">(sheetDataStartLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">,</span><span style="color:#E36209;">rowdata</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//数据检查 //根据不同sheetname，进行业务数据处理</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel sheet数据循环完毕</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sheetDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//把余下的sheet数据提交 </span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setSheetDataEndLoopHandle</span><span style="color:#24292E;">(sheetDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据循环完毕后</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//在此可以做数据提交，或者什么都不处理</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;==== excel data end loop handle ====&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//或者处理其他的非导入的功能。。如流程、发邮件、消息等</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//设置excel数据循环完毕后处理方法</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelDataEndLoopHandle</span><span style="color:#24292E;">(excelDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行数据导入</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><ul><li>非规范列头导入场景</li></ul><p>不是规范列头的excel数据</p><ol><li><p>逐行读取excel数据</p></li><li><p>传入给行数据处理的exceldata 是一个 List<object></object> 数组数据</p><ul><li>根据数组序号，去获取每个单元格的数据</li></ul><p>例如，导入以下的数据</p><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E5%A6%99%E5%8F%AF%E8%93%9D%E5%A4%9A.png" alt=""></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;importutils&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> masterobj </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;saledept&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;销售部门&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;salesman&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;业务员&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;billnumber&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;单据编号&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;supplier&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;供方&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;buyer&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;购方&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;buyercontact&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;购方联系人&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;suppliercontact&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;供方联系人&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;buyerphone&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;购方联系电话&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;supplierphone&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;供方联系电话&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;buyeraddress&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;购方收货地址&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;totalnum&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;总数量&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;totalprice&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;总金额&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> details </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> detailstart </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//数据处理 //进行业务性检查，及判断，进行那些数据提交操作</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">dealData</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">rownum</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//检查忽略策略处理</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//进行数据处理 //如果过程处理中，有业务检查出错，可直接处理出错调用</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;sheetname===&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">sheetname);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;rownum===&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">rownum);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;exceldata===&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">exceldata);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rownum </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//销售部门</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.saledept </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.salesman </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.billnumber </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rownum </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.supplier </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.buyer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rownum </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.buyercontact </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rownum </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.suppliercontact </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.buyerphone </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rownum </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.supplierphone </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.buyeraddress </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(exceldata[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;产品品称&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;产品规格&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    detailstart </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//通过判断是否合计，来判断</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(exceldata[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;合计&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.totalnum </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    masterobj.totalprice </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detailstart </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rownum </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> detailstart) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//明细数据</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> detail </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.productname </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.spec </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.number </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.amount </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.unitprice </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.price </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    detail.note </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> exceldata[</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">    details.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(detail);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">excelRowDataHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">exceldata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">customdata</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetname</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetrownum</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> check_res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">checkData</span><span style="color:#E1E4E8;">(exceldata);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">check_res) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//检查不通过，进行错误记录</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//EXCELIMP.errRecord(exceldata, check_res);</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    excelrow</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">dealData</span><span style="color:#E1E4E8;">(exceldata, customdata, sheetname, sheetrownum);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setExcelRowDataHandle</span><span style="color:#E1E4E8;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel sheet数据循环完毕</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sheetDataEndLoopHandle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">sheetName</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">sheetRowNum</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//提交数据</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setSheetDataEndLoopHandle</span><span style="color:#E1E4E8;">(sheetDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行原生数据导入</span></span>
<span class="line"><span style="color:#79B8FF;">EXCELIMP</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;2&quot;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//注： 此部分只是flycode中的片断</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">load</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;importutils&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> masterobj </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;saledept&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;销售部门&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;salesman&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;业务员&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;billnumber&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;单据编号&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;supplier&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;供方&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;buyer&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;购方&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;buyercontact&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;购方联系人&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;suppliercontact&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;供方联系人&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;buyerphone&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;购方联系电话&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;supplierphone&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;供方联系电话&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;buyeraddress&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;购方收货地址&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;totalnum&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;总数量&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;totalprice&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;总金额&quot;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> details </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> detailstart </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//数据处理 //进行业务性检查，及判断，进行那些数据提交操作</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">dealData</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">, </span><span style="color:#E36209;">rownum</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//检查忽略策略处理</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//进行数据处理 //如果过程处理中，有业务检查出错，可直接处理出错调用</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;sheetname===&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">sheetname);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;rownum===&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">rownum);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;exceldata===&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">exceldata);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rownum </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//销售部门</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.saledept </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.salesman </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.billnumber </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rownum </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.supplier </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.buyer </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rownum </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.buyercontact </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rownum </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.suppliercontact </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.buyerphone </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rownum </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.supplierphone </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.buyeraddress </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(exceldata[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;产品品称&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;产品规格&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    detailstart </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//通过判断是否合计，来判断</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(exceldata[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;合计&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.totalnum </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    masterobj.totalprice </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detailstart </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rownum </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> detailstart) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//明细数据</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> detail </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#24292E;">    detail.productname </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detail.spec </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detail.number </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detail.amount </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detail.unitprice </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detail.price </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    detail.note </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> exceldata[</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">    details.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(detail);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel数据行处理，参数传入excel数据行及自定义的参数入参</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">excelRowDataHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">exceldata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">customdata</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetname</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetrownum</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> check_res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">checkData</span><span style="color:#24292E;">(exceldata);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">check_res) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//检查不通过，进行错误记录</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//EXCELIMP.errRecord(exceldata, check_res);</span></span>
<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    excelrow</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">dealData</span><span style="color:#24292E;">(exceldata, customdata, sheetname, sheetrownum);</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//设置数据行处理</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setExcelRowDataHandle</span><span style="color:#24292E;">(excelRowDataHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//excel sheet数据循环完毕</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sheetDataEndLoopHandle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;">(</span><span style="color:#E36209;">sheetName</span><span style="color:#24292E;">, </span><span style="color:#E36209;">sheetRowNum</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//提交数据</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setSheetDataEndLoopHandle</span><span style="color:#24292E;">(sheetDataEndLoopHandle);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//执行原生数据导入</span></span>
<span class="line"><span style="color:#005CC5;">EXCELIMP</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;2&quot;</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><hr></li></ol><h2 id="文章导航" tabindex="-1">文章导航 <a class="header-anchor" href="#文章导航" aria-label="Permalink to &quot;文章导航&quot;">​</a></h2><p><a href="http://apaas.wxchina.com:8881/2020/09/10/export%e5%af%bc%e5%87%ba/" target="_blank" rel="noreferrer">Export导出</a></p><p><a href="http://apaas.wxchina.com:8881/2020/09/10/3-4-4-excel-flycode%e5%af%bc%e5%87%ba/" target="_blank" rel="noreferrer">3.4.4. Excel-flycode导出</a></p>`,70),e=[o];function c(t,r,E,y,i,u){return n(),a("div",null,e)}const d=s(p,[["render",c]]);export{b as __pageData,d as default};
