import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.b1e56e49.js";const F=JSON.parse('{"title":"原生语句操作","description":"","frontmatter":{"title":"原生语句操作","date":"2020-07-03T17:57:09.000Z"},"headers":[],"relativePath":"doc/wpdoc/原生语句操作.md","filePath":"doc/wpdoc/原生语句操作.md"}'),p={name:"doc/wpdoc/原生语句操作.md"},o=l(`<h1 id="_3-1-6-原生sql操作" tabindex="-1">3.1.6. 原生SQL操作 <a class="header-anchor" href="#_3-1-6-原生sql操作" aria-label="Permalink to &quot;3.1.6. 原生SQL操作&quot;">​</a></h1><p>最低版本要求：动态业务服务 V2.8.0</p><h2 id="_3-1-6-1-目的" tabindex="-1">3.1.6.1. 目的 <a class="header-anchor" href="#_3-1-6-1-目的" aria-label="Permalink to &quot;3.1.6.1. 目的&quot;">​</a></h2><ul><li>SQL api提供对数据库语句操作，支持原生查询、插入、更新、删除等操作，并支持调用存储过程。</li></ul><p><strong>API</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">//参数定义 params</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> params </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;key1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;value1&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;key2&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;value2&quot;</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql查询 返回List数据  [{&quot;column&quot;:&quot;value&quot;}]</span></span>
<span class="line"><span style="color:#6A737D;">//可支持存储过程调用</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> listResult </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(sql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql查询 返回单字符串数据 &quot;value&quot;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> strResult </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">queryForString</span><span style="color:#E1E4E8;">(sql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql查询 返回map数据  {&quot;key&quot;:&quot;value&quot;}</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> mapResult </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">queryForMap</span><span style="color:#E1E4E8;">(sql,params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql 返回被修改的行数</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> intResult </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">update</span><span style="color:#E1E4E8;">(sql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql 返回被修改的行数数组 </span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> intResults </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">batchUpdate</span><span style="color:#E1E4E8;">(sql, batchParams);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生查询，数据规则语句获取</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> ruleobj </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">//数据查询语句，用到的数据对象的对象名、表名、别名</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_objmaps </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;objectmark&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;tablename&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;alias&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_extraparam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#6A737D;">//返回 rule_res = {&quot;join_sql&quot;: &quot;&quot;, &quot;where_sql&quot;:&quot;&quot;, &quot;rule_param&quot;:{}}</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getRuleSql</span><span style="color:#E1E4E8;">(ruleobj,rule_objmaps,rule_extraparam);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">//参数定义 params</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> params </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;key1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;value1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;key2&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;value2&quot;</span><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql查询 返回List数据  [{&quot;column&quot;:&quot;value&quot;}]</span></span>
<span class="line"><span style="color:#6A737D;">//可支持存储过程调用</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> listResult </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(sql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql查询 返回单字符串数据 &quot;value&quot;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> strResult </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">queryForString</span><span style="color:#24292E;">(sql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql查询 返回map数据  {&quot;key&quot;:&quot;value&quot;}</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> mapResult </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">queryForMap</span><span style="color:#24292E;">(sql,params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql 返回被修改的行数</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> intResult </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">update</span><span style="color:#24292E;">(sql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生sql 返回被修改的行数数组 </span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> intResults </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">batchUpdate</span><span style="color:#24292E;">(sql, batchParams);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生查询，数据规则语句获取</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> ruleobj </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">//数据查询语句，用到的数据对象的对象名、表名、别名</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_objmaps </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;objectmark&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;tablename&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;alias&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_extraparam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#6A737D;">//返回 rule_res = {&quot;join_sql&quot;: &quot;&quot;, &quot;where_sql&quot;:&quot;&quot;, &quot;rule_param&quot;:{}}</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getRuleSql</span><span style="color:#24292E;">(ruleobj,rule_objmaps,rule_extraparam);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><hr><h2 id="_3-1-6-2-例子" tabindex="-1">3.1.6.2 例子 <a class="header-anchor" href="#_3-1-6-2-例子" aria-label="Permalink to &quot;3.1.6.2 例子&quot;">​</a></h2><ul><li>例子用到的数据表</li></ul><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> &quot;</span><span style="color:#B392F0;">public</span><span style="color:#E1E4E8;">&quot;.</span><span style="color:#9ECBFF;">&quot;test_simpletable&quot;</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;platcreatetime&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">timestamp</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">DEFAULT</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">&#39;now&#39;</span><span style="color:#E1E4E8;">::</span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">)::</span><span style="color:#F97583;">timestamp</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;"> with time zone</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;platupdatetime&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">timestamp</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">DEFAULT</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">&#39;now&#39;</span><span style="color:#E1E4E8;">::</span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">)::</span><span style="color:#F97583;">timestamp</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;"> with time zone</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;platcreateop&quot;</span><span style="color:#E1E4E8;"> int8,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;platupdateop&quot;</span><span style="color:#E1E4E8;"> int8,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;platstatus&quot;</span><span style="color:#E1E4E8;"> int4 </span><span style="color:#F97583;">DEFAULT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;simplecode&quot;</span><span style="color:#E1E4E8;"> int8 </span><span style="color:#F97583;">NOT NULL</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;simplename&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">COLLATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;simplememo&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">COLLATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#F97583;">CONSTRAINT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;pk_test_simpletable_1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">PRIMARY KEY</span><span style="color:#E1E4E8;"> (</span><span style="color:#9ECBFF;">&quot;simplecode&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">WITH</span><span style="color:#E1E4E8;"> (OIDS</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">FALSE)</span></span>
<span class="line"><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;public&quot;</span><span style="color:#E1E4E8;">.</span><span style="color:#9ECBFF;">&quot;test_simpletable&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">OWNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;postgres&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platcreatetime&quot; IS </span><span style="color:#9ECBFF;">&#39;平台固定字段，记录创建时间&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platupdatetime&quot; IS </span><span style="color:#9ECBFF;">&#39;平台固定字段，记录修改时间&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platcreateop&quot; IS </span><span style="color:#9ECBFF;">&#39;平台固定字段，创建人id&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platupdateop&quot; IS </span><span style="color:#9ECBFF;">&#39;平台固定字段，修改人id&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platstatus&quot; IS </span><span style="color:#9ECBFF;">&#39;平台固定字段，记录状态 1. 正常 2. 逻辑删除 3. 异常数据&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;simplecode&quot; IS </span><span style="color:#9ECBFF;">&#39;simplecode&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;simplename&quot; IS </span><span style="color:#9ECBFF;">&#39;simplename&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;simplememo&quot; IS </span><span style="color:#9ECBFF;">&#39;simplememo&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> &quot;</span><span style="color:#6F42C1;">public</span><span style="color:#24292E;">&quot;.</span><span style="color:#032F62;">&quot;test_simpletable&quot;</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#032F62;">&quot;platcreatetime&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">timestamp</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">DEFAULT</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&#39;now&#39;</span><span style="color:#24292E;">::</span><span style="color:#D73A49;">text</span><span style="color:#24292E;">)::</span><span style="color:#D73A49;">timestamp</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span><span style="color:#D73A49;"> with time zone</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;platupdatetime&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">timestamp</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">DEFAULT</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&#39;now&#39;</span><span style="color:#24292E;">::</span><span style="color:#D73A49;">text</span><span style="color:#24292E;">)::</span><span style="color:#D73A49;">timestamp</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span><span style="color:#D73A49;"> with time zone</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;platcreateop&quot;</span><span style="color:#24292E;"> int8,</span></span>
<span class="line"><span style="color:#032F62;">&quot;platupdateop&quot;</span><span style="color:#24292E;"> int8,</span></span>
<span class="line"><span style="color:#032F62;">&quot;platstatus&quot;</span><span style="color:#24292E;"> int4 </span><span style="color:#D73A49;">DEFAULT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;simplecode&quot;</span><span style="color:#24292E;"> int8 </span><span style="color:#D73A49;">NOT NULL</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;simplename&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">200</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">COLLATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;simplememo&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">200</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">COLLATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#D73A49;">CONSTRAINT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pk_test_simpletable_1&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PRIMARY KEY</span><span style="color:#24292E;"> (</span><span style="color:#032F62;">&quot;simplecode&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">WITH</span><span style="color:#24292E;"> (OIDS</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">FALSE)</span></span>
<span class="line"><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;public&quot;</span><span style="color:#24292E;">.</span><span style="color:#032F62;">&quot;test_simpletable&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">OWNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;postgres&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platcreatetime&quot; IS </span><span style="color:#032F62;">&#39;平台固定字段，记录创建时间&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platupdatetime&quot; IS </span><span style="color:#032F62;">&#39;平台固定字段，记录修改时间&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platcreateop&quot; IS </span><span style="color:#032F62;">&#39;平台固定字段，创建人id&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platupdateop&quot; IS </span><span style="color:#032F62;">&#39;平台固定字段，修改人id&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;platstatus&quot; IS </span><span style="color:#032F62;">&#39;平台固定字段，记录状态 1. 正常 2. 逻辑删除 3. 异常数据&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;simplecode&quot; IS </span><span style="color:#032F62;">&#39;simplecode&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;simplename&quot; IS </span><span style="color:#032F62;">&#39;simplename&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">COMMENT ON COLUMN &quot;public&quot;.&quot;test_simpletable&quot;.&quot;simplememo&quot; IS </span><span style="color:#032F62;">&#39;simplememo&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>例1</strong>: 原生查询</p><p>查询终端，以编码和名称作为入参，匹配查询。并且分页查询</p><ul><li>用到API</li></ul><ol><li>var tmp = SQL.query(sql,params);<br> 查询返回列表</li><li>var countres = SQL.queryForString(sql,params);<br> 查询返回数量</li></ol><ul><li>注意点</li></ul><ol><li>分页参数，需要自行组装</li><li>分页语句，也是自行组装</li></ol><ul><li>flycode</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">原生语句查询</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//入参参数</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _inparam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IN</span><span style="color:#E1E4E8;">.kx_kq_store;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页参数</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _pagingParam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IN</span><span style="color:#E1E4E8;">.__paging;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _pagesize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _offset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_pagingParam) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _pagesize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _pagingParam.__pagesize;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> pageindex </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _pagingParam.__pageindex;</span></span>
<span class="line"><span style="color:#E1E4E8;">  _offset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (pageindex </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> pageindex </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">  (pageindex </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> _pagesize);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//查询参数定义</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> params </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;storecode&quot;</span><span style="color:#E1E4E8;">: _inparam.storecode, </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;storname&quot;</span><span style="color:#E1E4E8;">: _inparam.storename,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;pagesize&quot;</span><span style="color:#E1E4E8;">: _pagesize,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;offset&quot;</span><span style="color:#E1E4E8;">: _offset</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _sqlBuilder </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _countSqlBuilder </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;select id, storecode, storename  from kx_kq_store where 1=1 &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">_countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;select count(*) from kx_kq_store where 1=1 &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_inparam.storecode) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  _countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_inparam.sotrename) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  _countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; order by updatetime desc &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_pagingParam) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    _sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; limit :pagesize offset :offset &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _sql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _sqlBuilder.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _countsql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _countSqlBuilder.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> tmp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(_sql, params);</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> countres  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">queryForString</span><span style="color:#E1E4E8;">(_countsql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">OUT</span><span style="color:#E1E4E8;">.kx_kq_store </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> tmp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//输出分页</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_pagingParam) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">OUT</span><span style="color:#E1E4E8;">.__paging </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;__pageindex&quot;</span><span style="color:#E1E4E8;">:  _pagingParam.__pageindex, </span><span style="color:#9ECBFF;">&quot;__pagesize&quot;</span><span style="color:#E1E4E8;">: _pagingParam.__pagesize, </span><span style="color:#9ECBFF;">&quot;__itemcount&quot;</span><span style="color:#E1E4E8;">: countres};</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">原生语句查询</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//入参参数</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _inparam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IN</span><span style="color:#24292E;">.kx_kq_store;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页参数</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _pagingParam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IN</span><span style="color:#24292E;">.__paging;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _pagesize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _offset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_pagingParam) {</span></span>
<span class="line"><span style="color:#24292E;">  _pagesize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _pagingParam.__pagesize;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> pageindex </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _pagingParam.__pageindex;</span></span>
<span class="line"><span style="color:#24292E;">  _offset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (pageindex </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> pageindex </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;">  (pageindex </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> _pagesize);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//查询参数定义</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> params </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;storecode&quot;</span><span style="color:#24292E;">: _inparam.storecode, </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;storname&quot;</span><span style="color:#24292E;">: _inparam.storename,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;pagesize&quot;</span><span style="color:#24292E;">: _pagesize,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;offset&quot;</span><span style="color:#24292E;">: _offset</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _sqlBuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _countSqlBuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;select id, storecode, storename  from kx_kq_store where 1=1 &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">_countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;select count(*) from kx_kq_store where 1=1 &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_inparam.storecode) {</span></span>
<span class="line"><span style="color:#24292E;">  _sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  _countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_inparam.sotrename) {</span></span>
<span class="line"><span style="color:#24292E;">  _sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  _countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; order by updatetime desc &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_pagingParam) {</span></span>
<span class="line"><span style="color:#24292E;">    _sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; limit :pagesize offset :offset &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _sql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _sqlBuilder.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _countsql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _countSqlBuilder.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> tmp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(_sql, params);</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> countres  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">queryForString</span><span style="color:#24292E;">(_countsql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">OUT</span><span style="color:#24292E;">.kx_kq_store </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tmp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//输出分页</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_pagingParam) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">OUT</span><span style="color:#24292E;">.__paging </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;__pageindex&quot;</span><span style="color:#24292E;">:  _pagingParam.__pageindex, </span><span style="color:#032F62;">&quot;__pagesize&quot;</span><span style="color:#24292E;">: _pagingParam.__pagesize, </span><span style="color:#032F62;">&quot;__itemcount&quot;</span><span style="color:#24292E;">: countres};</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><hr><p><strong>例2</strong>: 执行操作</p><p>insert update delete 等操作</p><ul><li>使用场景</li></ul><ol><li>更新或删除符合条件的数据</li><li>一个数据写入、更新、删除</li></ol><ul><li>用到API</li></ul><p>SQL.update(sql, params);</p><ul><li>flycode例子</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">update</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;update test_simpletable set simplename=:name where simplename=:qname&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;name&#39;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&#39;test3&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;qname&#39;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&#39;test1&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;影响的行数:&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> res);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">update</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;update test_simpletable set simplename=:name where simplename=:qname&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;name&#39;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&#39;test3&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;qname&#39;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&#39;test1&#39;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;影响的行数:&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> res);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><p><strong>例3</strong>: 批量操作</p><ul><li>用到API<br> SQL.batchUpdate(sql, paramsArray);</li><li>可用到场景</li></ul><ol><li>批量执行语句，传入的是一个数组数据。包括 insert\\update\\delete</li></ol><ul><li>flycode例子</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">batchUpdate</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;insert into test_simpletable (simplecode,simplename,simplememo) values(:code, :name, :name)&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    [{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;code&#39;</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">genId</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;name&#39;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&#39;test1&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">   {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;code&#39;</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">genId</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&#39;name&#39;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&#39;test2&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">   }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">batchUpdate</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;insert into test_simpletable (simplecode,simplename,simplememo) values(:code, :name, :name)&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    [{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;code&#39;</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">genId</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;name&#39;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&#39;test1&#39;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">   {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;code&#39;</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">genId</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&#39;name&#39;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&#39;test2&#39;</span></span>
<span class="line"><span style="color:#24292E;">   }</span></span>
<span class="line"><span style="color:#24292E;">  ]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><p><strong>例4</strong>: 存储过程</p><p>执行插入或更新存储过程，无返回值</p><ul><li>存储过程例子</li></ul><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">create or replace</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">Function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">myfuncupdateorinsertdatanoreturn</span><span style="color:#E1E4E8;">(simplecodep int8, simplenamep </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">, simplememop </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">returns</span><span style="color:#E1E4E8;"> void </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> $$</span></span>
<span class="line"><span style="color:#F97583;">declare</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">--变量声明</span></span>
<span class="line"><span style="color:#E1E4E8;">msgtip </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">sql</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">begin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">msgtip :</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">begin</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">exists</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_simpletable </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> simplecode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> simplecodep) </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#6A737D;">--更新</span></span>
<span class="line"><span style="color:#F97583;">UPDATE</span><span style="color:#E1E4E8;"> test_simpletable </span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;">  simplename</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">simplenamep, simplememo</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">simplememop,</span></span>
<span class="line"><span style="color:#E1E4E8;">       platupdatetime</span><span style="color:#F97583;">=now</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> simplecode </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> simplecodep;</span></span>
<span class="line"><span style="color:#F97583;">else</span></span>
<span class="line"><span style="color:#6A737D;">--插入</span></span>
<span class="line"><span style="color:#F97583;">INSERT INTO</span><span style="color:#E1E4E8;"> test_simpletable(</span></span>
<span class="line"><span style="color:#E1E4E8;">            simplecode, simplename, simplememo)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">VALUES</span><span style="color:#E1E4E8;"> (simplecodep, simplenamep, simplememop);</span></span>
<span class="line"><span style="color:#F97583;">end</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">exception</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;">  others  </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">    msgtip :</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;出现错误&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">end</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">end</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">$$ </span><span style="color:#F97583;">language</span><span style="color:#E1E4E8;"> plpgsql;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">create or replace</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">Function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">myfuncupdateorinsertdatanoreturn</span><span style="color:#24292E;">(simplecodep int8, simplenamep </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">, simplememop </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">returns</span><span style="color:#24292E;"> void </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> $$</span></span>
<span class="line"><span style="color:#D73A49;">declare</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">--变量声明</span></span>
<span class="line"><span style="color:#24292E;">msgtip </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">sql</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">msgtip :</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">begin</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">exists</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_simpletable </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> simplecode </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> simplecodep) </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#6A737D;">--更新</span></span>
<span class="line"><span style="color:#D73A49;">UPDATE</span><span style="color:#24292E;"> test_simpletable </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">SET</span><span style="color:#24292E;">  simplename</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">simplenamep, simplememo</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">simplememop,</span></span>
<span class="line"><span style="color:#24292E;">       platupdatetime</span><span style="color:#D73A49;">=now</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> simplecode </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> simplecodep;</span></span>
<span class="line"><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#6A737D;">--插入</span></span>
<span class="line"><span style="color:#D73A49;">INSERT INTO</span><span style="color:#24292E;"> test_simpletable(</span></span>
<span class="line"><span style="color:#24292E;">            simplecode, simplename, simplememo)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">VALUES</span><span style="color:#24292E;"> (simplecodep, simplenamep, simplememop);</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">exception</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">when</span><span style="color:#24292E;">  others  </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">    msgtip :</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;出现错误&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">end</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">$$ </span><span style="color:#D73A49;">language</span><span style="color:#24292E;"> plpgsql;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>用到API</li></ul><ol><li>SQL.query(sql, params);</li></ol><ul><li>注意点</li></ul><ol><li>存储过程中，异常捕捉问题？</li><li>由于该种写法，是无返回的处理，建议少用</li></ol><ul><li>flycode</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">调用存储过程 无返回</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _inparam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IN</span><span style="color:#E1E4E8;">.test_simpletable;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> params </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;simplecodep&quot;</span><span style="color:#E1E4E8;">: _inparam.simplecode,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;simplenamep&quot;</span><span style="color:#E1E4E8;">:_inparam.simplename,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;simplememop&quot;</span><span style="color:#E1E4E8;">: _inparam.simplememo</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _sql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;select * from myfuncupdateorinsertdatanoreturn(:simplecodep,:simplenamep,:simplememop)&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(_sql, params);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">调用存储过程 无返回</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _inparam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IN</span><span style="color:#24292E;">.test_simpletable;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> params </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;simplecodep&quot;</span><span style="color:#24292E;">: _inparam.simplecode,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;simplenamep&quot;</span><span style="color:#24292E;">:_inparam.simplename,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;simplememop&quot;</span><span style="color:#24292E;">: _inparam.simplememo</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _sql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;select * from myfuncupdateorinsertdatanoreturn(:simplecodep,:simplenamep,:simplememop)&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(_sql, params);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>例子5</strong> 原生查询 规则语句API使用</p><ul><li>查询终端数据，用了终端对象数据规则</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">规则语句API使用例子</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#6A737D;">//入参参数</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _inparam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IN</span><span style="color:#E1E4E8;">.kx_kq_store;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页参数</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _pagingParam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IN</span><span style="color:#E1E4E8;">.__paging;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _pagesize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _offset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_pagingParam) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _pagesize </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _pagingParam.__pagesize;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> pageindex </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _pagingParam.__pageindex;</span></span>
<span class="line"><span style="color:#E1E4E8;">  _offset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (pageindex </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> pageindex </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">  (pageindex </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> _pagesize);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> params </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;storecode&quot;</span><span style="color:#E1E4E8;">: _inparam.storecode, </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;storname&quot;</span><span style="color:#E1E4E8;">: _inparam.storename,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;pagesize&quot;</span><span style="color:#E1E4E8;">: _pagesize,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;offset&quot;</span><span style="color:#E1E4E8;">: _offset</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//规则语句， 原生查询语句中用到的对象数据表及别名</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_objmaps </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;objectmark&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;tablename&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;alias&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_extraparam </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生查询，数据规则语句获取</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getRuleSql</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,rule_objmaps,rule_extraparam);</span></span>
<span class="line"><span style="color:#6A737D;">//返回规则语句的结果</span></span>
<span class="line"><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;join_sql====&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">rule_res.join_sql);</span></span>
<span class="line"><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;where_sql====&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">rule_res.where_sql);</span></span>
<span class="line"><span style="color:#79B8FF;">FLY</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;rule_param====&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">rule_res.rule_param);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//合并规则语句中的参数</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(rule_res </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> rule_res.rule_param </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> key </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> rule_res.rule_param) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    params[key] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rule_res.rule_param[key];</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//利用java的Map putAll方法</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//rule_res.rule_param.putAll(params);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//params = rule_res.rule_param;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _sqlBuilder </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _countSqlBuilder </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//SQL语句组装</span></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;select id, storecode, storename  from kx_kq_store &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(rule_res.join_sql);</span></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; where 1=1 &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">_countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;select count(*) from kx_kq_store &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">_countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(rule_res.join_sql);</span></span>
<span class="line"><span style="color:#E1E4E8;">_countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; where 1=1 &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_inparam.storecode) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  _countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_inparam.sotrename) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  _sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  _countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(rule_res.where_sql);</span></span>
<span class="line"><span style="color:#E1E4E8;">_countSqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(rule_res.where_sql);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">_sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; order by updatetime desc &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_pagingParam) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    _sqlBuilder.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot; limit :pagesize offset :offset &quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _sql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _sqlBuilder.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> _countsql </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> _countSqlBuilder.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> tmp </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(_sql, params);</span></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> countres  </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">queryForString</span><span style="color:#E1E4E8;">(_countsql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">OUT</span><span style="color:#E1E4E8;">.kx_kq_store </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> tmp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//输出分页</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!!</span><span style="color:#E1E4E8;">_pagingParam) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">OUT</span><span style="color:#E1E4E8;">.__paging </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;__pageindex&quot;</span><span style="color:#E1E4E8;">:  _pagingParam.__pageindex, </span><span style="color:#9ECBFF;">&quot;__pagesize&quot;</span><span style="color:#E1E4E8;">: _pagingParam.__pagesize, </span><span style="color:#9ECBFF;">&quot;__itemcount&quot;</span><span style="color:#E1E4E8;">: countres};</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;">规则语句API使用例子</span></span>
<span class="line"><span style="color:#6A737D;">*/</span></span>
<span class="line"><span style="color:#6A737D;">//入参参数</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _inparam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IN</span><span style="color:#24292E;">.kx_kq_store;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页参数</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _pagingParam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IN</span><span style="color:#24292E;">.__paging;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _pagesize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _offset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_pagingParam) {</span></span>
<span class="line"><span style="color:#24292E;">  _pagesize </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _pagingParam.__pagesize;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> pageindex </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _pagingParam.__pageindex;</span></span>
<span class="line"><span style="color:#24292E;">  _offset </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (pageindex </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> pageindex </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">:</span><span style="color:#24292E;">  (pageindex </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> _pagesize);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> params </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;storecode&quot;</span><span style="color:#24292E;">: _inparam.storecode, </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;storname&quot;</span><span style="color:#24292E;">: _inparam.storename,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;pagesize&quot;</span><span style="color:#24292E;">: _pagesize,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;offset&quot;</span><span style="color:#24292E;">: _offset</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//规则语句， 原生查询语句中用到的对象数据表及别名</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_objmaps </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;objectmark&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;tablename&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;alias&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_extraparam </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//原生查询，数据规则语句获取</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getRuleSql</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,rule_objmaps,rule_extraparam);</span></span>
<span class="line"><span style="color:#6A737D;">//返回规则语句的结果</span></span>
<span class="line"><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;join_sql====&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">rule_res.join_sql);</span></span>
<span class="line"><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;where_sql====&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">rule_res.where_sql);</span></span>
<span class="line"><span style="color:#005CC5;">FLY</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;rule_param====&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">rule_res.rule_param);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//合并规则语句中的参数</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(rule_res </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> rule_res.rule_param </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">var</span><span style="color:#24292E;"> key </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> rule_res.rule_param) {</span></span>
<span class="line"><span style="color:#24292E;">    params[key] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> rule_res.rule_param[key];</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//利用java的Map putAll方法</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//rule_res.rule_param.putAll(params);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//params = rule_res.rule_param;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _sqlBuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _countSqlBuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//SQL语句组装</span></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;select id, storecode, storename  from kx_kq_store &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(rule_res.join_sql);</span></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; where 1=1 &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">_countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;select count(*) from kx_kq_store &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">_countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(rule_res.join_sql);</span></span>
<span class="line"><span style="color:#24292E;">_countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; where 1=1 &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_inparam.storecode) {</span></span>
<span class="line"><span style="color:#24292E;">  _sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  _countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storecode like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storecode, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_inparam.sotrename) {</span></span>
<span class="line"><span style="color:#24292E;">  _sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  _countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; and storename like CONCAT(CONCAT(&#39;%&#39;,REPLACE(REPLACE(:storename, &#39;%&#39;, &#39;/%&#39;), &#39;_&#39;, &#39;/_&#39;)), &#39;%&#39;) ESCAPE &#39;/&#39; &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(rule_res.where_sql);</span></span>
<span class="line"><span style="color:#24292E;">_countSqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(rule_res.where_sql);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">_sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; order by updatetime desc &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//分页</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_pagingParam) {</span></span>
<span class="line"><span style="color:#24292E;">    _sqlBuilder.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot; limit :pagesize offset :offset &quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _sql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _sqlBuilder.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> _countsql </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> _countSqlBuilder.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> tmp </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(_sql, params);</span></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> countres  </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">queryForString</span><span style="color:#24292E;">(_countsql, params);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">OUT</span><span style="color:#24292E;">.kx_kq_store </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tmp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//输出分页</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!!</span><span style="color:#24292E;">_pagingParam) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">OUT</span><span style="color:#24292E;">.__paging </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;__pageindex&quot;</span><span style="color:#24292E;">:  _pagingParam.__pageindex, </span><span style="color:#032F62;">&quot;__pagesize&quot;</span><span style="color:#24292E;">: _pagingParam.__pagesize, </span><span style="color:#032F62;">&quot;__itemcount&quot;</span><span style="color:#24292E;">: countres};</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><ul><li>用到API</li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_res </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SQL</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getRuleSql</span><span style="color:#E1E4E8;">(ruleobj,rule_objmaps,rule_extraparam);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_res </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SQL</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getRuleSql</span><span style="color:#24292E;">(ruleobj,rule_objmaps,rule_extraparam);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注：</p><ol><li>ruleobj 查询的规则对象的名称 如： kx_kq_store</li><li>rule_objmaps 查询语句中用到的数据对象 对象名、表名、别名 如：</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> rule_objmaps </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;objectmark&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;tablename&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;alias&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;kx_kq_store&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">];</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> rule_objmaps </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;objectmark&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;tablename&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;alias&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;kx_kq_store&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li>rule_extraparam 额外参数</li><li>rule_res 结果</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;join_sql&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;where_sql&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;rule_param&quot;</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;join_sql&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;where_sql&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;rule_param&quot;</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol><li>取到结果后，需要把语句与原本查询语句，进行合并，把 rule_param 与原查询语句的参数进行合并</li></ol><hr>`,56),e=[o];function r(t,c,E,y,i,u){return n(),a("div",null,e)}const b=s(p,[["render",r]]);export{F as __pageData,b as default};
