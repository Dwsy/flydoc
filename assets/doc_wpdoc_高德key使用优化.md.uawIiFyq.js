import{_ as a,o as e,c as s,R as n}from"./chunks/framework.S1SDgkSw.js";const k=JSON.parse('{"title":"高德key使用优化","description":"","frontmatter":{"title":"高德key使用优化","date":"2022-06-15T07:26:18.000Z"},"headers":[],"relativePath":"doc/wpdoc/高德key使用优化.md","filePath":"doc/wpdoc/高德key使用优化.md"}'),l={name:"doc/wpdoc/高德key使用优化.md"},i=n(`<h1 id="高德key使用优化" tabindex="-1">高德key使用优化 <a class="header-anchor" href="#高德key使用优化" aria-label="Permalink to &quot;高德key使用优化&quot;">​</a></h1><p>版本： V9.7.3</p><h2 id="需求背景" tabindex="-1">需求背景 <a class="header-anchor" href="#需求背景" aria-label="Permalink to &quot;需求背景&quot;">​</a></h2><h3 id="存在问题" tabindex="-1">存在问题 <a class="header-anchor" href="#存在问题" aria-label="Permalink to &quot;存在问题&quot;">​</a></h3><ol><li>web包原有内置Key流量限制已无法使用</li><li>所有租户共同使用公司内置key将造成流量过载问题，租户需要能使用自己申请的key</li><li>高德地图限制：2021年后高德Key基于安全性，必须搭配安全密钥一起使用</li></ol><h3 id="问题解决" tabindex="-1">问题解决 <a class="header-anchor" href="#问题解决" aria-label="Permalink to &quot;问题解决&quot;">​</a></h3><ol><li>公司已申请新的key，替换web包默认内置key为新的高德key</li><li>租户可通过IDE配置/修改部署包代码的方式配置自己申请的高德key</li><li>web包默认内置代理地址进行验证，同时租户亦可通过上述方法进行配置代理地址</li><li><strong>租户尽量使用自己申请的key，避免共用内置key导致流量超载问题</strong></li></ol><h2 id="使用方法" tabindex="-1">使用方法 <a class="header-anchor" href="#使用方法" aria-label="Permalink to &quot;使用方法&quot;">​</a></h2><h3 id="_1-申请租户高德web端-js-api-的key以及安全密钥" tabindex="-1">1. 申请租户高德Web端（JS API)的Key以及安全密钥 <a class="header-anchor" href="#_1-申请租户高德web端-js-api-的key以及安全密钥" aria-label="Permalink to &quot;1\\. 申请租户高德Web端（JS API)的Key以及安全密钥&quot;">​</a></h3><p><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E7%94%B3%E8%AF%B7%E9%AB%98%E5%BE%B7key.png" alt=""></p><h3 id="_2-配置服务器代理地址" tabindex="-1">2. 配置服务器代理地址 <a class="header-anchor" href="#_2-配置服务器代理地址" aria-label="Permalink to &quot;2\\. 配置服务器代理地址&quot;">​</a></h3><p><a href="https://lbs.amap.com/api/javascript-api/guide/abc/prepare" title="安全密钥使用说明" target="_blank" rel="noreferrer">安全密钥使用说明</a><br> 代理服务器server配置：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>server {</span></span>
<span class="line"><span>      listen 7799;</span></span>
<span class="line"><span>      location /_AMapService/ {</span></span>
<span class="line"><span>         set $args &quot;$args&amp;jscode=816fe46b7b7bce145940b93c1e4818fa&quot;;</span></span>
<span class="line"><span>         proxy_pass https://restapi.amap.com/;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>   }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>jscode为申请key对应的安全密钥，代理地址为实际验证地址，以此保证密钥安全性</li><li>代理服务器地址，要看客户项目部署是https还是http决定</li><li>内外网同时要使用的情况下，需要配置内外网都可用的代理地址</li></ul><h3 id="_3-配置key以及代理地址" tabindex="-1">3. 配置key以及代理地址 <a class="header-anchor" href="#_3-配置key以及代理地址" aria-label="Permalink to &quot;3\\. 配置key以及代理地址&quot;">​</a></h3><p>tip：划分不同情境进行使用</p><p>（1）租户环境以及转移中心登录并开通租户环境配置<br> IDE租户环境配置支持配置 高德Key值 + 代理服务器，配置前两步得到的key以及代理地址后保存即可生效<br><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%85%8D%E7%BD%AE%E9%AB%98%E5%BE%B7key.png" alt=""></p><p>（2）租户使用非中心登录或使用中心登录但未开通租户环境配置<br> 由于Key和代理服务器无法动态替换，产品包默认内置开发测试环境的Key以及代理服务器；上线租户需要替换租户Key以及代理服务器地址，只能通过替换部署包硬编码内容的方案实现。</p><p>例子：web V9.7.3<br> 目录路径：<br><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%83%A8%E7%BD%B2%E5%8C%85.png" alt=""></p><p>具体做法：部署包文件在js/目录下搜索GDkey，查找到截图位置，分别替换Key和代理服务器地址即可。<br><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E4%BF%AE%E6%94%B9%E9%83%A8%E7%BD%B2%E5%8C%85.png" alt=""></p><p>备注：基于旧web包替换文本的方案修复问题，由于hash值不变，客户浏览器需要强制刷新（or 清除缓存）生效</p><h2 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-label="Permalink to &quot;其他&quot;">​</a></h2><h3 id="错误提示" tabindex="-1">错误提示 <a class="header-anchor" href="#错误提示" aria-label="Permalink to &quot;错误提示&quot;">​</a></h3><p>当使用的key或代理地址错误时会在控制台中报错<br><img src="http://apaas.wxchina.com:8881/wp-content/uploads/%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA.png" alt=""></p><h3 id="生产环境" tabindex="-1">生产环境 <a class="header-anchor" href="#生产环境" aria-label="Permalink to &quot;生产环境&quot;">​</a></h3><ul><li>新Key: 找PMO部门-瑞烜获取</li><li>安全密钥：找PMO部门-瑞烜获取</li></ul><h3 id="开发测试环境" tabindex="-1">开发测试环境 <a class="header-anchor" href="#开发测试环境" aria-label="Permalink to &quot;开发测试环境&quot;">​</a></h3><ul><li>key：38fa4702d240e1e6ee5cc8ca059b254f</li><li>安全密钥：96f2af5670b7a41a56dcd2e8b63c1e06</li></ul><h3 id="web包当前内置" tabindex="-1">web包当前内置 <a class="header-anchor" href="#web包当前内置" aria-label="Permalink to &quot;web包当前内置&quot;">​</a></h3><ul><li>key：1993ac213d2f4675ac1bffb1b03ef1f0</li><li>代理地址：<a href="http://61.144.58.3:31810/_AMapService" target="_blank" rel="noreferrer">http://61.144.58.3:31810/_AMapService</a></li></ul>`,30),t=[i];function r(p,o,c,h,d,b){return e(),s("div",null,t)}const m=a(l,[["render",r]]);export{k as __pageData,m as default};
